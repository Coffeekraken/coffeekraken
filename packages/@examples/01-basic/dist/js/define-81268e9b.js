import{F as V,x as k,c as f,G as v,H as x,I as S,J as C,S as A,K as b,e as E,L,j as g,k as j,_ as M}from"./index.esm.js";import{_ as B}from"./querySelectorUp-ecdaf0f7.js";function D(e){return typeof e=="string"&&e!==""&&e.trim()!==""&&/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e)}function O(e){return/^(?:(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11}))$/.test(e)}function T(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.toLowerCase())}function N(e){return e.match(/^([0-9]{4})-(1[0-2]|0[1-9])$/)||e.match(/^([0-9]{4})-?(1[0-2]|0[1-9])-?(3[01]|0[1-9]|[12][0-9])$/)||e.match(/^([0-9]{4})(-?)(1[0-2]|0[1-9])\2(3[01]|0[1-9]|[12][0-9])$/)||e.match(/^([0-9]{4})-?(36[0-6]|3[0-5][0-9]|[12][0-9]{2}|0[1-9][0-9]|00[1-9])$/)}function z(e){return e.match(/^([0-9]{4})-?(1[0-2]|0[1-9])-?(3[01]|0[1-9]|[12][0-9])â†µ\s(2[0-3]|[01][0-9]):?([0-5][0-9]):?([0-5][0-9])$/)||e.match(/^(?:([0-9]{4})-?(1[0-2]|0[1-9])-?(3[01]|0[1-9]|[12][0-9])\s(2[0-3]|[01][0-9]):?([0-5][0-9]):?([0-5][0-9])|([0-9]{4})(1[0-2]|0[1-9])(3[01]|0[1-9]|[12][0-9])\s(2[0-3]|[01][0-9])([0-5][0-9])([0-5][0-9]))$/)}function Z(e){return e.match(/^(2[0-3]|[01][0-9]):?([0-5][0-9])$/)||e.match(/^(2[0-3]|[01][0-9]):?([0-5][0-9]):?([0-5][0-9])$/)||e.match(/^(Z|[+-](?:2[0-3]|[01][0-9])(?::?(?:[0-5][0-9]))?)$/)||e.match(/^(2[0-3]|[01][0-9]):?([0-5][0-9]):?([0-5][0-9])(Z|[+-](?:2[0-3]|[01][0-9])(?::?(?:[0-5][0-9]))?)$/)}function q(e){try{return!!new URL(e)}catch{return!1}}function d(e,r){var t;const s=Object.assign({tokens:{}},r??{});r=(r=V.get("i18n"))!=null?r:{};let i;if(r=` ${i=(i=s.id?(t=r[s.id])!=null?t:k(r,s.id):i)||((t=r[e])!=null?t:e)} `.match(/(__\([^__\)]*\)__|(?!\|)%[a-zA-Z0-9])/gm),r){let l=function(n){var u;return(u=(u=s.tokens[n])!=null?u:s.tokens[n.replace(/^%/,"")])!=null?u:n},a;r.forEach(n=>{if(n.match(/^%/)){var u=l(a=n);i=i.replaceAll(new RegExp("([^(])?"+n,"g"),"$1"+u)}else{var u=n.match(/\|(%[a-zA-Z0-9]+)\)__/),u=(u=u==null?void 0:u[1])!=null?u:a,c=l(u);if(typeof c!="number")i=i.replace(n,`**(invalid token "${u}" for pluralization)**`);else{let p=(n=n.replace(/\\\|/gm,"_$_")).split(/\|/gm);p=p.map(w=>w.replace(/_\$_/gm,"|").replace(/^__\(/,"").replace(/\)__$/,"")),n=n.replace(/_\$_/gm,"\\|"),p.length===1?i=i.replace(n,1<c?p[0]:""):p.length===2&&p[0].match(/^%[a-zA-Z0-9]+/)?i=i.replace(n,1<c?p[1]:""):p.length!==2||p[0].match(/^%[a-zA-Z0-9]+/)?p.length===3&&(i=i.replace(n,1<c?p[2]:p[1])):i=i.replace(n,1<c?p[1]:p[0])}}})}return i}const R={min:{string:d("Must have at least %n characters",{id:"s-validator.min.string"}),object:d("Must have at least %n properties",{id:"s-validator.min.object"}),number:d("Must be greater than %n",{id:"s-validator.min.number"}),array:d("Must have at least %n items",{id:"s-validator.min.array"})},max:{string:d("Must have at max %n characters",{id:"s-validator.max.string"}),object:d("Must have at max %n properties",{id:"s-validator.max.object"}),number:d("Must be lower than %n",{id:"s-validator.max.number"}),array:d("Must have at max %n items",{id:"s-validator.max.array"})},email:{default:d("Must be a valid email address",{id:"s-validator.email.default"})},required:{default:d("This is required",{id:"s-validator.required.default"})},isoDate:{default:d("Must be a valid ISO date",{id:"s-validator.isoDate.default"})},isoTime:{default:d("Must be a valid ISO time",{id:"s-validator.isoTime.default"})},isoDateTime:{default:d("Must be a valid ISO date time",{id:"s-validator.isoDateTime.default"})},integer:{default:d("Must be an integer",{id:"s-validator.integer.default"})},number:{default:d("Must be an number",{id:"s-validator.number.default"})},negative:{default:d("Must be a negative number",{id:"s-validator.negative.default"})},positive:{default:d("Must be a positive number",{id:"s-validator.positive.default"})},pattern:{default:d("Must match the pattern %pattern",{id:"s-validator.pattern.default"})},alphanum:{default:d("Must contain only alphanumeric characters",{id:"s-validator.alphanum.default"})},creditCard:{default:d("Must be a valid credit card number",{id:"s-validator.creditCard.default"})},color:{default:d("Must be a valid color (hex, rgb, rgba, hsl, hsla)",{id:"s-validator.color.default"})},hex:{default:d("Must be a valid hex color",{id:"s-validator.hex.default"})},type:{default:d("Must be of type %type",{id:"s-validator.type.default"})},base64:{default:d("Must be a valid base64 string",{id:"s-validator.base64.default"})},url:{default:d("Must be a valid url",{id:"s-validator.url.default"}),secure:d("Must be a secure url",{id:"s-validator.url.secure"})},password:{default:d("Must be a password string",{id:"s-validator.password.default"}),weak:d("Must be a password elligible string",{id:"s-validator.password.weak"}),medium:d("Must be >=6 characters, at least 1 lowercase/uppercase/special character",{id:"s-validator.password.medium"}),strong:d("Must be >=8 characters, at least 1 lowercase/uppercase/digit/special character",{id:"s-validator.password.strong"})}},I={description:"Validate a specific type",type:"String",values:["string","number","boolean","integer","array","object"]};function F(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.type},t??{});switch(r.toLowerCase()){case"array":i=Array.isArray(e);break;case"boolean":i=e===!0||e===!1;break;case"integer":i=x(e);break;case"number":i=typeof e=="number";break;case"string":i=typeof e=="string";break;case"object":i=v(e);break;case"checkbox":case"select":i=v(e)&&e.id;break;case"image":i=v(e)&&e.url;break;case"video":i=v(e)&&e.sources&&(e.sources.webm||e.sources.mp4||e.sources.ogg);break;case"datetime":i=v(e)&&e.iso&&e.value&&e.format;break;case"link":i=v(e)&&e.text&&e.url;break;case"color":i=v(e)&&(e.format==="hex"||e.format==="hexa"||e.format==="hsl"||e.format==="hsla"||e.format==="rgb"||e.format==="rgba")&&e.value}return i||(s=(t=a.i18n)==null?void 0:t.default.replace("%type",a.type)),{valid:i,message:s}}const H={description:"Validate a base64 string",type:"Boolean"};function P(e,r,a){let s;var i,a=f({i18n:a.i18n.base64,trim:!0},a??{});return typeof e!="string"?{valid:!1,message:(i=a.i18n)==null?void 0:i.default}:{valid:i=D(e=a.trim?e.trim():e),message:s=i?s:a.i18n.default}}const U={description:"Validate an alphanum string",type:"Boolean"};function G(e,r,t){let s,i;return t=f({i18n:t.i18n.alphanum,trim:!0},t??{}),typeof e!="string"?{valid:!1,message:t.i18n.default}:{valid:i=(e=t.trim?e.trim():e).match(/^[a-z0-9]+$/i),message:s=i?s:(e=t.i18n)==null?void 0:e.default}}const J={description:"Validate a color string",type:"Boolean"};function K(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.color,trim:!0},t??{});return typeof e!="string"?{valid:!1,message:a.i18n.default}:(a.trim&&(e=e.trim()),{valid:i=S(e),message:s=i?s:(t=a.i18n)==null?void 0:t.default})}const W={description:"Validate a credit card string",type:"Boolean"};function Y(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.creditCard,trim:!0},t??{});return typeof e!="string"?{valid:!1,message:a.i18n.default}:{valid:i=O(e=a.trim?e.trim():e),message:s=i?s:(t=a.i18n)==null?void 0:t.default}}const Q={description:"Validate an email string",type:"Boolean"};function X(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.email,trim:!0},t??{});return typeof e!="string"?{valid:!1,message:a.i18n.default}:{valid:i=T(e=a.trim?e.trim():e),message:s=i?s:(t=a.i18n)==null?void 0:t.default}}const ee={description:"Validate a hexadecimal string",type:"Boolean"};function te(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.hex,trim:!0},t??{});return typeof e!="string"?{valid:!1,message:a.i18n.default}:{valid:i=(e=a.trim?e.trim():e).match(/^#[a-zA-Z0-9]{3,6}$/),message:s=i?s:(t=a.i18n)==null?void 0:t.default}}const ie={description:"Validate an integer",type:"Boolean"};function ae(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.integer,cast:!0,trim:!0},t??{});return typeof e!="string"&&typeof e!="number"?{valid:!1,message:a.i18n.default}:(typeof(e=typeof e=="string"&&a.trim?e.trim():e)=="string"&&a.cast&&(e=Number(e)),(i=!isNaN(e)&&Number.isInteger(e))||(s=(t=a.i18n)==null?void 0:t.default),{valid:i,message:s})}const re={description:"Validate an iso date string",type:"Boolean"};function se(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.isoDate,trim:!0},t??{});return typeof e!="string"?{valid:!1,message:a.i18n.default}:{valid:i=N(e=a.trim?e.trim():e),message:s=i?s:(t=a.i18n)==null?void 0:t.default}}const ne={description:"Validate an iso date string",type:"Boolean"};function le(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.isoDateTime,trim:!0},t??{});return typeof e!="string"?{valid:!1,message:a.i18n.default}:{valid:i=z(e=a.trim?e.trim():e),message:s=i?s:(t=a.i18n)==null?void 0:t.default}}const oe={description:"Validate an iso time string",type:"Boolean"};function de(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.isoTime,trim:!0},t??{});return typeof e!="string"?{valid:!1,message:a.i18n.default}:{valid:i=Z(e=a.trim?e.trim():e),message:s=i?s:(t=a.i18n)==null?void 0:t.default}}const ue={description:'Validate string, array, object and number using the "max" rule',type:"Number"};function ce(e,r,t){var s,i;let a,l;var n=f({i18n:(s=t==null?void 0:t.i18n)==null?void 0:s.max,trim:!0},t??{});switch(!0){case typeof e=="string":n.trim&&(e=e.trim()),l=e.length<=r,a=(i=n.i18n)==null?void 0:i.string.replace("%n",r);break;case typeof e=="number":l=e<=r,a=(i=n.i18n)==null?void 0:i.number.replace("%n",r);break;case Array.isArray(e):l=e.length<=r,a=(i=n.i18n)==null?void 0:i.array.replace("%n",r);break;case typeof e=="object":l=Object.keys(e).length<=r,a=(i=n.i18n)==null?void 0:i.object.replace("%n",r);break;default:return{valid:!1,message:n.i18n.string}}return{valid:l,message:a}}const fe={description:'Validate string, array, object and number using the "min" rule',type:"Number"};function pe(e,r,t){var s,i;let a,l;var n=f({i18n:(s=t==null?void 0:t.i18n)==null?void 0:s.min,trim:!0},t??{});switch(!0){case typeof e=="string":n.trim&&(e=e.trim()),l=e.length>=r,a=(i=n.i18n)==null?void 0:i.string.replace("%n",r);break;case typeof e=="number":l=r<=e,a=(i=n.i18n)==null?void 0:i.number.replace("%n",r);break;case Array.isArray(e):l=e.length>=r,a=(i=n.i18n)==null?void 0:i.array.replace("%n",r);break;case typeof e=="object":l=Object.keys(e).length>=r,a=(i=n.i18n)==null?void 0:i.object.replace("%n",r);break;default:return{valid:!1,message:n.i18n.string}}return{valid:l,message:a}}const me={description:"Validate an negative number",type:"Boolean"};function ve(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.negative,cast:!0,trim:!0},t??{});return typeof e!="string"&&typeof e!="number"?{valid:!1,message:a.i18n.default}:(typeof(e=typeof e=="string"&&a.trim?e.trim():e)=="string"&&a.cast&&(e=Number(e)),(i=!isNaN(e)&&e<0)||(s=(t=a.i18n)==null?void 0:t.default),{valid:i,message:s})}const he={description:"Validate an number",type:"Boolean"};function ge(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.number,cast:!0,trim:!0},t??{});return typeof e!="string"&&typeof e!="number"?{valid:!1,message:a.i18n.default}:(typeof(e=typeof e=="string"&&a.trim?e.trim():e)=="string"&&a.cast&&(e=Number(e)),(i=!isNaN(e))||(s=(t=a.i18n)==null?void 0:t.default),{valid:i,message:s})}const ye={description:"Validate a password string",type:"String"};function be(e,r,t){let s,i=!1;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.password,trim:!0,weakReg:/.*/,mediumReg:/((?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[^A-Za-z0-9])(?=.{6,}))|((?=.*[a-z])(?=.*[A-Z])(?=.*[^A-Za-z0-9])(?=.{8,}))/,strongReg:/(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[^A-Za-z0-9])(?=.{8,})/},t??{});return typeof e!="string"?{valid:!1,message:a.i18n.default}:(a.trim&&(e=e.trim()),t=[],a.weakReg.test(e)&&(e&&t.push("weak"),r==="weak")&&(i=!0),a.mediumReg.test(e)&&(e&&t.push("medium"),r==="medium")&&(i=!0),(i=a.strongReg.test(e)&&(e&&t.push("strong"),r==="strong")?!0:i)||(s=(e=a.i18n)==null?void 0:e[r]),{valid:i,message:s,metas:{levels:["weak","medium","strong"],validLevels:t}})}const _e={description:"Validate a string using a regex pattern",type:"String"};function $e(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.pattern,trim:!0},t??{});return typeof e!="string"?{valid:!1,message:a.i18n.default}:(a.trim&&(e=e.trim()),{valid:i=new RegExp(r).test(e),message:s=i?s:(t=a.i18n)==null?void 0:t.default.replace("%pattern",r)})}const we={description:"Validate an positive number",type:"Boolean"};function Ve(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.positive,cast:!0,trim:!0},t??{});return typeof e!="string"&&typeof e!="number"?{valid:!1,message:a.i18n.default}:(typeof(e=typeof e=="string"&&a.trim?e.trim():e)=="string"&&a.cast&&(e=Number(e)),(i=!isNaN(e)&&0<=e)||(s=(t=a.i18n)==null?void 0:t.default),{valid:i,message:s})}const ke={description:"Make sure a value has been provided",type:"Boolean"};function xe(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.required,trim:!0},t??{});return{valid:i=(e=typeof e=="string"&&a.trim?e.trim():e)!=null&&e!=="",message:s=i?s:(t=a.i18n)==null?void 0:t.default}}const Se={description:"Make sure the provided value is a valid url",type:"Boolean"};function Ce(e,r,t){let s,i;var a=f({i18n:(a=t==null?void 0:t.i18n)==null?void 0:a.url,trim:!0,secure:!1},t??{});return typeof e=="string"&&a.trim&&(e=e.trim()),(i=q(e))||(s=(t=a.i18n)==null?void 0:t.default),i&&a.secure&&(e.match(/^https:\/\//)||(i=!1,s=(t=a.i18n)==null?void 0:t.secure)),{valid:i,message:s}}class o extends C{static registerValidator(r,t,s){o._validators[r]={validator:t,settings:s}}static registerPreset(r,t,s){o._presets[r]={rules:t,settings:s}}static getValidatorsDefinition(){var r,t,s={};for([r,t]of Object.entries(o._validators))t.settings.definition&&(s[r]=t.settings.definition);return s}constructor(r){super(f({i18n:R},r??{}))}validate(r,t){var s,i,a={valid:!0,rules:{},messages:[]};let l=t;if(typeof t=="string"){if(!o._presets[t])throw new Error(`Sorry but the preset "${t}" is not registered`);l=o._presets[t].rules}if(!l.required&&(r==null||r===""))return{valid:!0,messages:null};for([s,i]of Object.entries(l)){var n=v(i)?i:{},u=(u=i==null?void 0:i.value)!=null?u:i,c=o._validators[s];if(!c)throw new Error(`Sorry but the validator "${s}" is not registered`);n=Object.assign(Object.assign({},n),{i18n:(n=this.settings.i18n[s])!=null?n:{}}),(c=c.validator(r,u,n)).valid?a.rules[s]=c:(c.message=(u=c.message)==null?void 0:u.replace("%value",r).replace("%validator",s),a.valid=!1,a.rules[s]=c,a.messages.push(c.message))}return a}}o._validators={},o._presets={},o.registerValidator("base64",P,{definition:H}),o.registerValidator("min",pe,{definition:fe}),o.registerValidator("max",ce,{definition:ue}),o.registerValidator("email",X,{definition:Q}),o.registerValidator("required",xe,{definition:ke}),o.registerValidator("isoDate",se,{definition:re}),o.registerValidator("isoTime",de,{definition:oe}),o.registerValidator("isoDateTime",le,{definition:ne}),o.registerValidator("integer",ae,{definition:ie}),o.registerValidator("number",ge,{definition:he}),o.registerValidator("negative",ve,{definition:me}),o.registerValidator("positive",Ve,{definition:we}),o.registerValidator("pattern",$e,{definition:_e}),o.registerValidator("alphanum",G,{definition:U}),o.registerValidator("creditCard",Y,{definition:W}),o.registerValidator("color",K,{definition:J}),o.registerValidator("hex",te,{definition:ee}),o.registerValidator("type",F,{definition:I}),o.registerValidator("password",be,{definition:ye}),o.registerValidator("url",Ce,{definition:Se});const Ae=`@keyframes error-message-appear{0%{line-height:1;max-height:0}to{max-height:2em;line-height:2}}.s-form-validate+.s-form-validate-error-message{text-align:end;color:hsla(calc(var(--s-color-error-h, 0) + var(--s-color-error-spin ,0)),calc((var(--s-color-error-s, 0)) * 1%),calc((var(--s-color-error-l, 0)) * 1%),var(--s-color-error-a, 1));overflow:hidden;max-height:0;line-height:1;margin:0;animation:.2s error-message-appear var(--s-easing-default, 0) forwards}
`,_=o.getValidatorsDefinition(),$={};for(let[e,r]of Object.entries(_))$[e+"Message"]={description:`The message to display when the validator "${e}" fails`,type:"String"};class h extends A{static get _definition(){return Object.assign(Object.assign(Object.assign({},_),$),{type:{description:"Specify the validation type. Usually automatically detected depending on the field type",type:"String",default:"text"},on:{description:'Specify when to trigger a validation. Can be "change","submit","enter" and/or "reset"',type:"Array<String>",values:["keyup","change","submit","enter","reset"],default:["keyup","change","submit","enter","reset"]},format:{description:'Specify if you want your value to be formatted a certain way. You can specify every "import { __format } from `@coffeekraken/sugar/string`" supported formats',type:"String",values:b.formats},errorClass:{description:"Specify the class to apply when theres an error",type:"String",default:"s-form-validate--error s-color--error"},validClass:{description:"Specify the class to apply on your s-form-validate element when validation is passed successfully",type:"String",default:"s-form-validate--valid s-color--success"},handlers:{description:'Specify some custom handlers by validator that will be executed in addition to the default validate behavior. The handler will take as argument an object containing the "result" SValidator result, the "$feature" that represent the s-validate node, the "$form" node if exists, the "$node" attached node if using the "nodes" property, the "$field" that represent the input field handled and the "props" that represent the feature properties',type:"Object",default:{}},nodes:{description:'Specify a css selector that target some HTMLElements used for the validation. Every HTMLElement has to specify 1 validator by using element attributes (same as on the feature itself). Classes are applied on each "node" to specify if the validator is valid or not',type:"String"},language:{description:"Specify the language you want to use for messages",type:"String",default:"en"},displayError:{description:"Specify if you want to display the error messages or not",type:"Boolean",default:!0},errorContainerAttr:{description:"Specify the attribute to search for the error container. If not found, a default container will be created and inserted after your s-form-validate element",type:"String",default:"s-form-validate-error"}})}}var Ee=globalThis&&globalThis.__awaiter||function(e,r,t,s){return new(t=t||Promise)(function(i,a){function l(c){try{u(s.next(c))}catch(m){a(m)}}function n(c){try{u(s.throw(c))}catch(m){a(m)}}function u(c){var m;c.done?i(c.value):((m=c.value)instanceof t?m:new t(function(p){p(m)})).then(l,n)}u((s=s.apply(e,r||[])).next())})};class y extends E{constructor(r,t,s){var i;Object.keys((i=(i=L.getDefaultProps(r))==null?void 0:i.customValidations)!=null?i:{}).forEach(a=>{h.definition[a]||(h.definition[a]={type:"String|Boolean"})}),super(r,t,f({name:"s-form-validate",interface:h,style:Ae},s??{})),this._nodeByValidator={},this._isDirty=!1,this._isValidating=!1,(i=this.props.handlers)!=null&&i.password||(r=this.props.handlers)!=null&&(r.password=this._passwordDefaultHandler),this._validator=new o,this._$form=B(this.node,"form"),this._$form&&this._$form.addEventListener("submit",a=>{var l;if(!this._$form._submitHandler){this._$form._submitHandler=!0;const n=[],u=c=>{n.push(c.detail)};this._$form.addEventListener("s-form-validate.error",u),a.preventDefault(),a instanceof CustomEvent&&((l=a.detail)==null||!l.internal)||a.stopPropagation(),setTimeout(()=>{delete this._$form._submitHandler,this._$form.removeEventListener("s-form-validate.error",u),n.length||(this._$form.submit(),a instanceof CustomEvent)||this._$form.dispatchEvent(new CustomEvent("submit",{bubbles:!0,cancelable:!0}))})}}),this.utils.exposeApi({validate:this.validate},this),this.props.nodes&&(this._$nodes=this.node.querySelectorAll(this.props.nodes),this._$nodes.forEach(a=>{for(let n=0;n<a.attributes.length;n++){var l=a.attributes[n];l.name in this.props&&(this.props[g(l.name)]=j(l.value),this._nodeByValidator[g(l.name)]=a)}}))}mount(){M("input,textarea,select",r=>{this._initField(r)},{rootNode:this.node,scopes:!1})}_passwordDefaultHandler({result:r,$feature:t}){var s;r.valid?(t.classList.remove("password-weak"),t.classList.remove("password-medium"),t.classList.remove("password-strong")):(s=r.metas)!=null&&s.levels&&r.metas.levels.forEach(i=>{i!==r.metas.validLevels.slice(-1)[0]?t.classList.remove("password-"+i):t.classList.add("password-"+i)})}_initField(r){this._$field=r,this._$field=this.node,r=this.node.querySelector("input,textarea,select"),r&&(this._$field=r),this._$field.setAttribute("novalidate","true"),["required","maxlength","minlength","max","min","pattern"].forEach(t=>{!this._$field.hasAttribute(t)||this.props[t]||(this.props[t]=this._$field.getAttribute(t),t!=="maxlength"&&t!=="minlength"&&this._$field.removeAttribute(t))}),["keydown","change"].forEach(t=>{this._$field.addEventListener(t,s=>{!this.props.format||s.target.type!=="text"&&s.target.tagName.toLowerCase()!=="textarea"||setTimeout(()=>{var i=this.format((i=s.target.value)!=null?i:"",this.props.format);i!==s.target.value&&(this._$field.value=i)})})}),this.props.on.forEach(t=>{var s;t==="enter"?this._$field.addEventListener("keyup",i=>{i.keyCode===13&&(this._$form?this._$form.dispatchEvent(new CustomEvent("submit",{bubbles:!1,detail:{internal:!0}})):this.validate(i))}):t==="reset"?(s=this._$field.form)!=null&&s.addEventListener(t,i=>{setTimeout(()=>{this.validate(i)})}):t==="submit"?(s=this._$field.form)!=null&&s.addEventListener(t,i=>{var a;i.preventDefault(),i instanceof CustomEvent&&((a=i.detail)==null||!a.internal)||(i.stopPropagation(),this.validate(i))}):t==="keyup"?this.node.addEventListener(t,i=>{this._isDirty&&this.validate(i)}):this.node.addEventListener(t,i=>{this.validate(i)})})}format(r,t){return b(r,t)}validate(r){var t;if(!this._$field)throw new Error("No $field has been found to be validated...");var s=this._getFieldValue();if(((t=r==null?void 0:r.currentTarget)==null?void 0:t.tagName.toLowerCase())==="form"&&r.type!=="reset"&&r.preventDefault(),!this._isValidating){this._isValidating=!0,setTimeout(()=>{this._isValidating=!1});let n;var i,a,l={};for([i,a]of Object.entries(o.getValidatorsDefinition()))this.props[i]!==void 0&&(l[i]=this.props[i]);l.type==="text"&&(l.type="string"),n=this._validator.validate(s,l),r.type==="reset"&&(n={valid:!0}),this._applyResult(n,r)}}_getFieldValue(){switch(!0){case this._$field.type==="checkbox":return this._getCheckboxValues();case this._$field.type==="range":return this._getRangeValue();case this._$field.tagName.toLowerCase()==="select":return this._getSelectValues();case this._$field.type==="radio":return this._getRadioValue();default:return this._$field.value}}_getCheckboxValues(){return Array.from(this.node.querySelectorAll('input[type="checkbox"]:checked')).map(r=>r.value)}_getRadioValue(){return this.node.querySelector('input[type="radio"]:checked').value}_getRangeValue(){return parseFloat(this._$field.value)}_getSelectValues(){return Array.from(this._$field.querySelectorAll("option")).filter(r=>r.selected).map(r=>r.value)}_applyResult(r,t){var s,i;return Ee(this,void 0,void 0,function*(){for(var[a,l]of Object.entries(o.getValidatorsDefinition()))this.props[a]&&this.props.handlers[a]&&(yield this.props.handlers[a]({result:Object.assign({},(s=(s=r.rules)==null?void 0:s[a])!=null?s:r),props:this.props,$feature:this.node,$form:this._$form,$field:this._$field,$node:(s=this._nodeByValidator)==null?void 0:s[a]}));if(r.valid){if(this._isDirty=!1,t.type!=="reset"?this.node.classList.add(...this.props.validClass.split(" ")):this.node.classList.remove(...this.props.validClass.split(" ")),this.node.classList.remove(...this.props.errorClass.split(" ")),(i=this._$error)!=null&&i.hasAttribute("s-form-validate-error")&&(i=this._$error)!=null&&i.remove(),Object.keys(this._nodeByValidator).length)for(var[n,u]of Object.entries(r.rules))this._nodeByValidator[n]&&(this._nodeByValidator[n].classList.remove(...this.props.errorClass.split(" ")),this._nodeByValidator[n].classList.add(...this.props.validClass.split(" ")));this.utils.dispatchEvent("valid",{detail:r})}else{this._isDirty=!0,this.node.classList.add(...this.props.errorClass.split(" ")),this.node.classList.remove(...this.props.validClass.split(" "));var c=Object.keys(r.rules)[0];if(Object.keys(this._nodeByValidator).length)for(var[m,p]of Object.entries(r.rules))this._nodeByValidator[m]&&(p.valid?(this._nodeByValidator[m].classList.remove(...this.props.errorClass.split(" ")),this._nodeByValidator[m].classList.add(...this.props.validClass.split(" "))):(this._nodeByValidator[m].classList.remove(...this.props.validClass.split(" ")),this._nodeByValidator[m].classList.add(...this.props.errorClass.split(" "))));else c=this.props[c+"Message"]||r.messages[0],this.props.displayError&&(this._$error=(i=this.node.querySelector(`[${this.props.errorContainerAttr}]`))!=null?i:this.node.nextElementSibling,this._$error&&this._$error.hasAttribute("s-form-validate-error")||(this._$error=document.createElement("p"),this._$error.setAttribute("s-form-validate-error","true"),this._$error.classList.add("s-form-validate-error-message"),this.node.parentNode.insertBefore(this._$error,this.node.nextSibling)),this._$error.innerHTML=c);this.utils.dispatchEvent("error",{detail:r})}})}}function Me(e={},r="s-form-validate"){y.define(r,y,Object.assign({mountWhen:"inViewport"},e))}export{Me as default};

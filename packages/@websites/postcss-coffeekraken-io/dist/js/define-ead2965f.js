import{a as f,b as g,c as m,d as v,e as y,f as S,g as _,h as b,i as A}from"./index.esm.js";function E(o){var a,t=document.createElement("div");const e=[];return Array.from(o.content.childNodes).forEach(i=>{var r;i.tagName==="SCRIPT"?document.head.appendChild(i):e.push((r=i.outerHTML)!=null?r:i.textContent)}),t.innerHTML=e.join(`
`),(a=o.parentElement)!=null&&a.insertBefore(t,o),o.remove(),t}class T extends f{static get _definition(){return{href:{description:"Specify the target element(s) to activate/unactivate",type:"String",default:""},group:{description:"Specify a group id for your element. This is used for things like tabs, etc...",type:"String"},toggle:{description:"Specify if you want to be able to click on the same element to activate/unactivate it.",type:{type:"Boolean",nullishAsTrue:!0},default:!1},history:{description:"Specify if you want to store and react to history hash changes",type:{type:"Boolean",nullishAsTrue:!0},default:!1},active:{description:"Specify the initial state of your element",type:{type:"Boolean",nullishAsTrue:!0},default:!1,physical:!0},activeClass:{description:'Specify the class applied on target(s) when active. Default is "active"',type:"String",default:"active"},activeAttribute:{description:"Specify the attribute name applied on target(s) when active.",type:"String",default:"active"},saveState:{description:"Specify if you want to save state in localStorage to restore it on page reload, etc...",type:"Boolean",default:!1},activateTimeout:{description:"Specify a timeout before actiavting the target(s)",type:"Number",default:0},unactivateTimeout:{description:"Specify a timeout before unactivate the target(s)",type:"Number",default:0},triggerer:{description:"Specify an element selector that will be used as the triggerer instead of this current element",type:"String"},trigger:{description:'Specify what trigger an activate/unactivate action. Can be "click", "mouseover", "mouseout" ,"anchor", "event:%eventName" "and/or" "cookie:%cookieName.%optionalDotPath". When using the "event:", the listener will be the node itself by default but you can specify the "document" like so "event:%eventName:document". When using "cookie", you can negate the assertion like so "!cookie:myCookie.myValue"',type:{type:"Array<String>",splitChars:[","," "]},values:["click","mouseover","mouseenter","mouseout","mouseleave","anchor"],default:["click"]},unactivateOn:{description:"Specify some event(s) catched on the body tag that will unactivate the target(s)",type:{type:"Array<String>",splitChars:[","," "]}}}}}var l=globalThis&&globalThis.__awaiter||function(o,a,t,e){return new(t=t||Promise)(function(i,r){function u(n){try{s(e.next(n))}catch(h){r(h)}}function c(n){try{s(e.throw(n))}catch(h){r(h)}}function s(n){var h;n.done?i(n.value):((h=n.value)instanceof t?h:new t(function(p){p(h)})).then(u,c)}s((e=e.apply(o,a||[])).next())})};class d extends g{constructor(a,t,e){super(a,t,m({interface:T},e??{})),this._$groupElements=[],this.state={active:void 0},this.groupState={activeId:void 0},this.state=this.utils.handleState(this.state,{save:this.props.saveState}),this.props.group&&this.utils.handleState(this.groupState,{save:this.props.saveState,id:"s-activate-feature-group-"+this.props.group}),this.props.triggerer?this._$triggerers=Array.from(document.querySelectorAll(this.props.triggerer)):this._$triggerers=[this.node],this.utils.exposeApi({activate:this.activate,unactivate:this.unactivate,isActive:this.isActive},this)}mount(){this.props.href&&(this._hrefSelector=this.props.href);let a;this._hrefSelector&&(a=Array.from(document.querySelectorAll(this._hrefSelector))),this._$targets=[this.node,...a??[]],this.props.group&&v(`[${this.name}][group="${this.props.group}"]`,t=>{var e;(e=this._$groupElements)!=null&&e.includes(t)||(e=this._$groupElements)!=null&&e.push(t)},{}),this._$triggerers.forEach(t=>{var e=t.hasAttribute("trigger")?t.getAttribute("trigger").split(",").map(i=>i.trim()):[];y([...this.props.trigger,...e]).forEach(i=>{if(i.match(/^\!?cookie:/)){var r=i.startsWith("!"),c=i.replace(/^\!?cookie:/,""),u=c.split(".")[0],c=c.split(".").slice(1).join(".");let s=S(u);s&&c&&(s=_(s,c)),(r&&!s||!r&&s)&&this.activate({preventSave:!0})}else if(i.match(/^event:/))u=i.replace(/^event:/,""),c=u.split(":")[0],(u.split(":").pop()==="document"?document:this.node).addEventListener(c,s=>{this.activate({preventSave:!0})});else if(i.match(/^scrollspy/)){let s=i.split(":"),n=this.props.href,h=(r=this.props.group)!=null?r:"scrollspy";s.length===2&&(n=s[1]),v(n,p=>{b(p,{group:h}).on("activate",()=>{this.isActive()||this.activate()}).on("unactivate",()=>{this.isActive()&&this.unactivate()})})}else switch(i){case"click":t.addEventListener("click",s=>{s.target!==t&&(s.target.parentElement!==t||s.currentTarget!==t)||(s.preventDefault(),s.stopPropagation(),this.isActive()&&this.props.toggle?this.unactivate():this.activate())});break;case"mousenter":case"mouseover":t.addEventListener("mouseover",s=>{this.activate()});break;case"mouseout":case"mouseleave":t.addEventListener("mouseleave",s=>{this.unactivate()});break;case"anchor":document.location.hash===this._hrefSelector&&this.activate(),window.addEventListener("hashchange",s=>{document.location.hash===this._hrefSelector&&this.activate()})}})}),this.props.unactivateOn&&this.props.unactivateOn.forEach(t=>{var e,i;t.match(/^event:/)?(i=(e=t.replace(/^event:/,"")).split(":")[0],(e.split(":").pop()==="document"?document:this.node).addEventListener(i,r=>{this.unactivate()})):t==="click"&&document.addEventListener("click",r=>{this.unactivate()})}),setTimeout(()=>l(this,void 0,void 0,function*(){if(this.props.saveState)this._restoreState();else if(this.props.active)this.activate();else if(this.props.group&&this._$groupElements[0]===this.node){yield A();let t=!1;for(let e=0;e<this._$groupElements.length;e++)if(this._$groupElements[e].isActive()){t=!0;break}t||this.activate()}}))}isActive(){return this.state.active}_restoreState(){return this.groupState.activeId&&this.groupState.activeId===this.node.id?this.activate({force:!0}):this.groupState.activeId&&this.groupState.activeId!==this.node.id?void 0:this.state.active||this.state.active===void 0&&this.props.active?this.activate({force:!0}):this.unactivate({force:!0})}activate(a){return l(this,void 0,void 0,function*(){var t=Object.assign({force:!1,preventSave:!1},a??{});clearTimeout(this._unactivateTimeout),!t.force&&this.isActive()||(t=()=>{this.props.history&&this._hrefSelector&&(document.location.hash=this._hrefSelector),this._$groupElements&&(this.groupState.activeId=this.node.id,this._$groupElements.forEach(e=>{e!==this.node&&e.unactivate()})),this.state.active=!0,this.props.active=!0,this._$targets.forEach(e=>{this.props.activeClass&&e.classList.add(this.props.activeClass),this.props.activeAttribute&&this.utils.fastdom.mutate(()=>{e.setAttribute(this.props.activeAttribute,"true")}),e.children.length&&Array.from(e.children).forEach(i=>{i instanceof HTMLTemplateElement&&E(i)}),this.node.dispatchEvent(new CustomEvent("s-activate.activate",{bubbles:!0}))})},this.props.activateTimeout?setTimeout(t,this.props.activateTimeout):t())})}unactivate(a){return l(this,void 0,void 0,function*(){var t;(Object.assign({force:!1,preventSave:!1},a??{}).force||this.isActive())&&(t=()=>{this.state.active=!1,this.props.active=!1,this._$targets.forEach(e=>{this.props.activeClass&&e.classList.remove(this.props.activeClass),this.props.activeAttribute&&e.removeAttribute(this.props.activeAttribute),this.node.dispatchEvent(new CustomEvent("s-activate.unactivate",{bubbles:!0}))})},this.props.unactivateTimeout?this._unactivateTimeout=setTimeout(t,this.props.unactivateTimeout):t())})}}function w(o={},a="s-activate"){d.define(a,d,o)}export{w as default};

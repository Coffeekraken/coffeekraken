import*as t from"riot";import e from"@coffeekraken/s-request";import r from"@coffeekraken/s-interface";import n from"@coffeekraken/s-component-utils";import{v4 as o}from"uuid";import i from"@coffeekraken/s-cache";import s from"chalk";import c from"copy-to";import{highlight as a}from"cli-highlight";import{decycle as u}from"json-cyclic";class f extends r{}f.definition={method:{type:"String",values:["get","post"],default:"get"},url:{type:"String",required:!0},trigger:{type:"String",values:["event"],default:"event"},on:{type:"String"},cache:{type:"String|Boolean",default:!1}};var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function p(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})})),e}var h,y={exports:{}},d={exports:{}},g=new Proxy({},{get(){throw new Error('Module "crypto" has been externalized for browser compatibility and cannot be accessed in client code.')}}),m=p(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:g}));d.exports=h=h||function(t,e){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==l&&l.crypto&&(r=l.crypto),!r&&"function"==typeof require)try{r=m}catch(g){}var n=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(g){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(g){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function t(){}return function(e){var r;return t.prototype=e,r=new t,t.prototype=null,r}}(),i={},s=i.lib={},c=s.Base={extend:function(t){var e=o(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=s.WordArray=c.extend({init:function(t,r){t=this.words=t||[],this.sigBytes=r!=e?r:4*t.length},toString:function(t){return(t||f).stringify(this)},concat:function(t){var e=this.words,r=t.words,n=this.sigBytes,o=t.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var s=r[i>>>2]>>>24-i%4*8&255;e[n+i>>>2]|=s<<24-(n+i)%4*8}else for(i=0;i<o;i+=4)e[n+i>>>2]=r[i>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=c.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],r=0;r<t;r+=4)e.push(n());return new a.init(e,t)}}),u=i.enc={},f=u.Hex={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],o=0;o<r;o++){var i=e[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n+=2)r[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new a.init(r,e/2)}},p=u.Latin1={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],o=0;o<r;o++){var i=e[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n++)r[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new a.init(r,e)}},h=u.Utf8={stringify:function(t){try{return decodeURIComponent(escape(p.stringify(t)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(t){return p.parse(unescape(encodeURIComponent(t)))}},y=s.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=h.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r,n=this._data,o=n.words,i=n.sigBytes,s=this.blockSize,c=i/(4*s),u=(c=e?t.ceil(c):t.max((0|c)-this._minBufferSize,0))*s,f=t.min(4*u,i);if(u){for(var l=0;l<u;l+=s)this._doProcessBlock(o,l);r=o.splice(0,u),n.sigBytes-=f}return new a.init(r,f)},clone:function(){var t=c.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});s.Hasher=y.extend({cfg:c.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){y.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new d.HMAC.init(t,r).finalize(e)}}});var d=i.algo={};return i}(Math);var w=y.exports=function(t){return function(e){var r=t,n=r.lib,o=n.WordArray,i=n.Hasher,s=r.algo,c=[];!function(){for(var t=0;t<64;t++)c[t]=4294967296*e.abs(e.sin(t+1))|0}();var a=s.MD5=i.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var r=0;r<16;r++){var n=e+r,o=t[n];t[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i=this._hash.words,s=t[e+0],a=t[e+1],h=t[e+2],y=t[e+3],d=t[e+4],g=t[e+5],m=t[e+6],w=t[e+7],v=t[e+8],b=t[e+9],_=t[e+10],j=t[e+11],O=t[e+12],x=t[e+13],S=t[e+14],B=t[e+15],k=i[0],M=i[1],P=i[2],q=i[3];k=u(k,M,P,q,s,7,c[0]),q=u(q,k,M,P,a,12,c[1]),P=u(P,q,k,M,h,17,c[2]),M=u(M,P,q,k,y,22,c[3]),k=u(k,M,P,q,d,7,c[4]),q=u(q,k,M,P,g,12,c[5]),P=u(P,q,k,M,m,17,c[6]),M=u(M,P,q,k,w,22,c[7]),k=u(k,M,P,q,v,7,c[8]),q=u(q,k,M,P,b,12,c[9]),P=u(P,q,k,M,_,17,c[10]),M=u(M,P,q,k,j,22,c[11]),k=u(k,M,P,q,O,7,c[12]),q=u(q,k,M,P,x,12,c[13]),P=u(P,q,k,M,S,17,c[14]),k=f(k,M=u(M,P,q,k,B,22,c[15]),P,q,a,5,c[16]),q=f(q,k,M,P,m,9,c[17]),P=f(P,q,k,M,j,14,c[18]),M=f(M,P,q,k,s,20,c[19]),k=f(k,M,P,q,g,5,c[20]),q=f(q,k,M,P,_,9,c[21]),P=f(P,q,k,M,B,14,c[22]),M=f(M,P,q,k,d,20,c[23]),k=f(k,M,P,q,b,5,c[24]),q=f(q,k,M,P,S,9,c[25]),P=f(P,q,k,M,y,14,c[26]),M=f(M,P,q,k,v,20,c[27]),k=f(k,M,P,q,x,5,c[28]),q=f(q,k,M,P,h,9,c[29]),P=f(P,q,k,M,w,14,c[30]),k=l(k,M=f(M,P,q,k,O,20,c[31]),P,q,g,4,c[32]),q=l(q,k,M,P,v,11,c[33]),P=l(P,q,k,M,j,16,c[34]),M=l(M,P,q,k,S,23,c[35]),k=l(k,M,P,q,a,4,c[36]),q=l(q,k,M,P,d,11,c[37]),P=l(P,q,k,M,w,16,c[38]),M=l(M,P,q,k,_,23,c[39]),k=l(k,M,P,q,x,4,c[40]),q=l(q,k,M,P,s,11,c[41]),P=l(P,q,k,M,y,16,c[42]),M=l(M,P,q,k,m,23,c[43]),k=l(k,M,P,q,b,4,c[44]),q=l(q,k,M,P,O,11,c[45]),P=l(P,q,k,M,B,16,c[46]),k=p(k,M=l(M,P,q,k,h,23,c[47]),P,q,s,6,c[48]),q=p(q,k,M,P,w,10,c[49]),P=p(P,q,k,M,S,15,c[50]),M=p(M,P,q,k,g,21,c[51]),k=p(k,M,P,q,O,6,c[52]),q=p(q,k,M,P,y,10,c[53]),P=p(P,q,k,M,_,15,c[54]),M=p(M,P,q,k,a,21,c[55]),k=p(k,M,P,q,v,6,c[56]),q=p(q,k,M,P,B,10,c[57]),P=p(P,q,k,M,m,15,c[58]),M=p(M,P,q,k,x,21,c[59]),k=p(k,M,P,q,d,6,c[60]),q=p(q,k,M,P,j,10,c[61]),P=p(P,q,k,M,h,15,c[62]),M=p(M,P,q,k,b,21,c[63]),i[0]=i[0]+k|0,i[1]=i[1]+M|0,i[2]=i[2]+P|0,i[3]=i[3]+q|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,o=8*t.sigBytes;r[o>>>5]|=128<<24-o%32;var i=e.floor(n/4294967296),s=n;r[15+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),r[14+(o+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),t.sigBytes=4*(r.length+1),this._process();for(var c=this._hash,a=c.words,u=0;u<4;u++){var f=a[u];a[u]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8)}return c},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});function u(t,e,r,n,o,i,s){var c=t+(e&r|~e&n)+o+s;return(c<<i|c>>>32-i)+e}function f(t,e,r,n,o,i,s){var c=t+(e&n|r&~n)+o+s;return(c<<i|c>>>32-i)+e}function l(t,e,r,n,o,i,s){var c=t+(e^r^n)+o+s;return(c<<i|c>>>32-i)+e}function p(t,e,r,n,o,i,s){var c=t+(r^(e|~n))+o+s;return(c<<i|c>>>32-i)+e}r.MD5=i._createHelper(a),r.HmacMD5=i._createHmacHelper(a)}(Math),t.MD5}(d.exports);function v(t){return!!t&&("object"==typeof t&&((!t.constructor||"Object"===t.constructor.name)&&("[object Object]"===Object.prototype.toString.call(t)&&t===Object(t))))}function b(t){const e=t.concat();for(let r=0;r<e.length;++r)for(let t=r+1;t<e.length;++t)e[r]===e[t]&&e.splice(t--,1);return e}function _(...t){const e={array:!1,object:!0};function r(t,n){const o={};if(!t&&n)return n;if(!n&&t)return t;if(!t&&!n)return{};c(t).override(o);for(const i of Object.keys(n))if(!0===e.array&&Array.isArray(t[i])&&Array.isArray(n[i])){const e=b([...t[i],...n[i]]);o[i]=e}else!0===e.object&&v(t[i])&&v(n[i])?o[i]=r(t[i],n[i]):c(n).pick(i).toCover(o);return o}const n=t[t.length-1]||{};(n.array&&"boolean"==typeof n.array||n.object&&"boolean"==typeof n.object)&&(void 0!==n.array&&(e.array=n.array),void 0!==n.object&&(e.object=n.object),t.pop());let o={};for(let i=0;i<t.length;i++){o=r(o,t[i]||{})}return o}function j(t,e,r={},n=[]){r=_({classInstances:!1,array:!0,privateProps:!1,cloneFirst:!0},r);const o=Array.isArray(t),i=o?[]:r.cloneFirst?Object.assign({},t):t;return Object.keys(t).forEach((s=>{if(!r.privateProps&&s.match(/^_/))return;if(v(t[s])||(c=t[s])&&"object"==typeof c&&(!c.constructor||"Object"!==c.constructor.name)&&"[object Object]"!==Object.prototype.toString.call(c)&&c.constructor!==Object&&r.classInstances||Array.isArray(t[s])&&r.array){const c=j(t[s],e,r,[...n,s]);return void(o?i.push(c):i[s]=c)}var c;const a=e({object:t,prop:s,value:t[s],path:[...n,s].join(".")});-1!==a?o?i.push(a):i[s]=a:delete t[s]})),i}function O(t){const e={};for(let[r,n]of t)e[r]=n;return e}function x(t,e={}){if(e=_({beautify:!0,highlight:!0,verbose:!0,theme:{number:s.yellow,default:s.white,keyword:s.blue,regexp:s.red,string:s.whiteBright,class:s.yellow,function:s.yellow,comment:s.gray,variable:s.red,attr:s.green}},e),"string"==typeof t)return t;if(null===t)return"null";if(void 0===t)return"undefined";if(t instanceof Error){const r=t.toString();let n=t.stack;const o=t.message;return e.verbose?[`<red>${t.constructor.name||"Error"}</red>`,"",o,"",n].join("\n"):r}if(function(t){return t instanceof Map}(t)&&(t=O(t)),function(t){return t&&"object"==typeof t&&t.constructor===Object}(t)||function(t){return t&&"object"==typeof t&&t.constructor===Array}(t)||function(t){try{const e=JSON.parse(t);return!!Object.keys(e).length}catch(e){return!1}return!0}(t)){try{t=u(t)}catch(n){}t=j(t,(({value:t})=>t instanceof Map?O(t):t));let r=JSON.stringify(t,null,e.beautify?4:0);return r=r.replace(/"([^"]+)":/g,"$1:").replace(/\uFFFF/g,'\\"'),e.highlight&&(r=a(r,{language:"js",theme:e.theme})),r}if(function(t){return"boolean"==typeof t}(t))return t?"true":"false";if(function(t){return t&&"[object Function]"==={}.toString.call(t)}(t))return""+t;let r="";try{t=u(t),r=JSON.stringify(t,null,e.beautify?4:0)}catch(n){try{r=t.toString()}catch(o){r=t}}return r}const S={};var B=function(t){"string"!=typeof t&&(t=x(t));const e=w(t).toString();return S[e]=t,e};const k={css:'s-request,[is="s-request"]{ display: none; }',exports:{_inlineProxyObj:void 0,async onBeforeMount(){this.component=new n(this.root,this.props,{interface:f});const t=this.root.querySelector("script");if(t){const e=o();let r=t.innerText.trim();r=r.replace(/^export default /,`window['s-request-script-${e}'] = `);const n=document.createElement("script");n.text=r,t.parentNode.insertBefore(n,t),t.remove(),this._inlineProxyObj=window[`s-request-script-${e}`]}switch(this.component.props.cache&&(this._cache=new i("s-request")),this.component.props.trigger){case"event":if(!this.component.props.on)throw new Error(`<red>[s-request${this.root.id?`#${this.root.id}`:""}]</red> When using the trigger "event", you MUST specify the "<yellow>on</yellow>" property to tell the component which event to listen to`);if(!this.component.$targets.length)throw new Error(`<red>[s-request${this.root.id?`#${this.root.id}`:""}]</red> When using the trigger "event", you MUST specify the "<yellow>target</yellow>" property to tell the component which other HTMLElement to listen to`);this.component.addTargetsEventListener(this.component.props.on,(async t=>await this._request(t.detail)))}},async _request(t){var r,n,o;const i={type:this.component.props.type,url:this.component.props.url,data:t,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}},s=B(i);if(!1!==this.component.props.cache){let t=await this._cache.get(s);if(t)return(null==(r=this._inlineProxyObj)?void 0:r.response)&&(t=this._inlineProxyObj.response(t)),t}(null==(n=this._inlineProxyObj)?void 0:n.request)&&(t=this._inlineProxyObj.request(t));const c=new e(i);let a=await c.send();return!1!==this.component.props.cache&&await this._cache.set(s,a.data,{ttl:"string"==typeof this.component.props.cache?this.component.props.cache:-1}),(null==(o=this._inlineProxyObj)?void 0:o.response)&&(a=this._inlineProxyObj.response(a)),a},onMounted(){}},template:null,name:"s-request"};t.register("s-request",k),setTimeout((()=>{t.mount("s-request")})),k.mount=()=>{t.mount("s-request")},window.env||(window.env={SUGAR:{}}),window.env.SUGAR=JSON.parse('{"ENVIRONMENT":"development"}');

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("riot"),require("uuid"),require("@coffeekraken/s-promise"),require("@coffeekraken/s-request"),require("@coffeekraken/s-interface"),require("@coffeekraken/s-component-utils"),require("@coffeekraken/s-cache"),require("chalk"),require("copy-to"),require("cli-highlight"),require("json-cyclic")):"function"==typeof define&&define.amd?define(["riot","uuid","@coffeekraken/s-promise","@coffeekraken/s-request","@coffeekraken/s-interface","@coffeekraken/s-component-utils","@coffeekraken/s-cache","chalk","copy-to","cli-highlight","json-cyclic"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).index=t(e.riot,e.uuid,e.__SPromise,e.__SRequest,e.__SInterface,e.__SComponentUtils,e.__SCache,e.__chalk,e.__copyTo,e.cliHighlight,e.jsonCyclic)}(this,(function(e,t,r,n,o,i,c,s,a,u,f){"use strict";function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function d(e){if(e&&e.__esModule)return e;var t={__proto__:null,[Symbol.toStringTag]:"Module"};return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var h=d(e),p=l(r),y=l(n),g=l(o),b=l(i),v=l(c),m=l(s),w=l(a);function _(){return t.v4()}let j;const S={};class O extends g.default{}O.definition={method:{type:"String",values:["get","post"],default:"get"},url:{type:"String",required:!0},trigger:{type:"String",values:["event"],default:"event"},on:{type:"String"},cache:{type:"String|Boolean",default:!1}};var q="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function k(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t}var x,B={exports:{}},M={exports:{}},A=new Proxy({},{get(){throw new Error('Module "crypto" has been externalized for browser compatibility and cannot be accessed in client code.')}}),E=k(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:A}));M.exports=x=x||function(e,t){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==q&&q.crypto&&(r=q.crypto),!r&&"function"==typeof require)try{r=E}catch(y){}var n=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(y){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(y){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),i={},c=i.lib={},s=c.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=c.WordArray=s.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||f).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var c=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=c<<24-(n+i)%4*8}else for(i=0;i<o;i+=4)t[n+i>>>2]=r[i>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new a.init(t,e)}}),u=i.enc={},f=u.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(r,t/2)}},l=u.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(r,t)}},d=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},h=c.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,o=n.words,i=n.sigBytes,c=this.blockSize,s=i/(4*c),u=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*c,f=e.min(4*u,i);if(u){for(var l=0;l<u;l+=c)this._doProcessBlock(o,l);r=o.splice(0,u),n.sigBytes-=f}return new a.init(r,f)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});c.Hasher=h.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}});var p=i.algo={};return i}(Math),function(e,t){e.exports=function(e){return function(t){var r=e,n=r.lib,o=n.WordArray,i=n.Hasher,c=r.algo,s=[];!function(){for(var e=0;e<64;e++)s[e]=4294967296*t.abs(t.sin(e+1))|0}();var a=c.MD5=i.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,o=e[n];e[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i=this._hash.words,c=e[t+0],a=e[t+1],h=e[t+2],p=e[t+3],y=e[t+4],g=e[t+5],b=e[t+6],v=e[t+7],m=e[t+8],w=e[t+9],_=e[t+10],j=e[t+11],S=e[t+12],O=e[t+13],q=e[t+14],k=e[t+15],x=i[0],B=i[1],M=i[2],A=i[3];x=u(x,B,M,A,c,7,s[0]),A=u(A,x,B,M,a,12,s[1]),M=u(M,A,x,B,h,17,s[2]),B=u(B,M,A,x,p,22,s[3]),x=u(x,B,M,A,y,7,s[4]),A=u(A,x,B,M,g,12,s[5]),M=u(M,A,x,B,b,17,s[6]),B=u(B,M,A,x,v,22,s[7]),x=u(x,B,M,A,m,7,s[8]),A=u(A,x,B,M,w,12,s[9]),M=u(M,A,x,B,_,17,s[10]),B=u(B,M,A,x,j,22,s[11]),x=u(x,B,M,A,S,7,s[12]),A=u(A,x,B,M,O,12,s[13]),M=u(M,A,x,B,q,17,s[14]),x=f(x,B=u(B,M,A,x,k,22,s[15]),M,A,a,5,s[16]),A=f(A,x,B,M,b,9,s[17]),M=f(M,A,x,B,j,14,s[18]),B=f(B,M,A,x,c,20,s[19]),x=f(x,B,M,A,g,5,s[20]),A=f(A,x,B,M,_,9,s[21]),M=f(M,A,x,B,k,14,s[22]),B=f(B,M,A,x,y,20,s[23]),x=f(x,B,M,A,w,5,s[24]),A=f(A,x,B,M,q,9,s[25]),M=f(M,A,x,B,p,14,s[26]),B=f(B,M,A,x,m,20,s[27]),x=f(x,B,M,A,O,5,s[28]),A=f(A,x,B,M,h,9,s[29]),M=f(M,A,x,B,v,14,s[30]),x=l(x,B=f(B,M,A,x,S,20,s[31]),M,A,g,4,s[32]),A=l(A,x,B,M,m,11,s[33]),M=l(M,A,x,B,j,16,s[34]),B=l(B,M,A,x,q,23,s[35]),x=l(x,B,M,A,a,4,s[36]),A=l(A,x,B,M,y,11,s[37]),M=l(M,A,x,B,v,16,s[38]),B=l(B,M,A,x,_,23,s[39]),x=l(x,B,M,A,O,4,s[40]),A=l(A,x,B,M,c,11,s[41]),M=l(M,A,x,B,p,16,s[42]),B=l(B,M,A,x,b,23,s[43]),x=l(x,B,M,A,w,4,s[44]),A=l(A,x,B,M,S,11,s[45]),M=l(M,A,x,B,k,16,s[46]),x=d(x,B=l(B,M,A,x,h,23,s[47]),M,A,c,6,s[48]),A=d(A,x,B,M,v,10,s[49]),M=d(M,A,x,B,q,15,s[50]),B=d(B,M,A,x,g,21,s[51]),x=d(x,B,M,A,S,6,s[52]),A=d(A,x,B,M,p,10,s[53]),M=d(M,A,x,B,_,15,s[54]),B=d(B,M,A,x,a,21,s[55]),x=d(x,B,M,A,m,6,s[56]),A=d(A,x,B,M,k,10,s[57]),M=d(M,A,x,B,b,15,s[58]),B=d(B,M,A,x,O,21,s[59]),x=d(x,B,M,A,y,6,s[60]),A=d(A,x,B,M,j,10,s[61]),M=d(M,A,x,B,h,15,s[62]),B=d(B,M,A,x,w,21,s[63]),i[0]=i[0]+x|0,i[1]=i[1]+B|0,i[2]=i[2]+M|0,i[3]=i[3]+A|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;r[o>>>5]|=128<<24-o%32;var i=t.floor(n/4294967296),c=n;r[15+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),r[14+(o+64>>>9<<4)]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8),e.sigBytes=4*(r.length+1),this._process();for(var s=this._hash,a=s.words,u=0;u<4;u++){var f=a[u];a[u]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8)}return s},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,r,n,o,i,c){var s=e+(t&r|~t&n)+o+c;return(s<<i|s>>>32-i)+t}function f(e,t,r,n,o,i,c){var s=e+(t&n|r&~n)+o+c;return(s<<i|s>>>32-i)+t}function l(e,t,r,n,o,i,c){var s=e+(t^r^n)+o+c;return(s<<i|s>>>32-i)+t}function d(e,t,r,n,o,i,c){var s=e+(r^(t|~n))+o+c;return(s<<i|s>>>32-i)+t}r.MD5=i._createHelper(a),r.HmacMD5=i._createHmacHelper(a)}(Math),e.MD5}(M.exports)}(B);var P=B.exports;function N(e){return!!e&&("object"==typeof e&&((!e.constructor||"Object"===e.constructor.name)&&("[object Object]"===Object.prototype.toString.call(e)&&e===Object(e))))}function C(e){const t=e.concat();for(let r=0;r<t.length;++r)for(let e=r+1;e<t.length;++e)t[r]===t[e]&&t.splice(e--,1);return t}function z(...e){const t={array:!1,object:!0};function r(e,n){const o={};if(!e&&n)return n;if(!n&&e)return e;if(!e&&!n)return{};w.default(e).override(o);for(const i of Object.keys(n))if(!0===t.array&&Array.isArray(e[i])&&Array.isArray(n[i])){const t=C([...e[i],...n[i]]);o[i]=t}else!0===t.object&&N(e[i])&&N(n[i])?o[i]=r(e[i],n[i]):w.default(n).pick(i).toCover(o);return o}const n=e[e.length-1]||{};(n.array&&"boolean"==typeof n.array||n.object&&"boolean"==typeof n.object)&&(void 0!==n.array&&(t.array=n.array),void 0!==n.object&&(t.object=n.object),e.pop());let o={};for(let i=0;i<e.length;i++){o=r(o,e[i]||{})}return o}function D(e,t,r={},n=[]){r=z({classInstances:!1,array:!0,privateProps:!1,cloneFirst:!0},r);const o=Array.isArray(e),i=o?[]:r.cloneFirst?Object.assign({},e):e;return Object.keys(e).forEach((c=>{if(!r.privateProps&&c.match(/^_/))return;if(N(e[c])||(s=e[c])&&"object"==typeof s&&(!s.constructor||"Object"!==s.constructor.name)&&"[object Object]"!==Object.prototype.toString.call(s)&&s.constructor!==Object&&r.classInstances||Array.isArray(e[c])&&r.array){const s=D(e[c],t,r,[...n,c]);return void(o?i.push(s):i[c]=s)}var s;const a=t({object:e,prop:c,value:e[c],path:[...n,c].join(".")});-1!==a?o?i.push(a):i[c]=a:delete e[c]})),i}function H(e){const t={};for(const[r,n]of e)t[r]=n;return t}function F(e,t={}){if(t=z({beautify:!0,highlight:!0,verbose:!0,theme:{number:m.default.yellow,default:m.default.white,keyword:m.default.blue,regexp:m.default.red,string:m.default.whiteBright,class:m.default.yellow,function:m.default.yellow,comment:m.default.gray,variable:m.default.red,attr:m.default.green}},t),"string"==typeof e)return e;if(null===e)return null;if(void 0===e)return;if(e instanceof Error){const r=e.toString(),n=e.stack,o=e.message;return t.verbose?[`<red>${e.constructor.name||"Error"}</red>`,"",o,"",n].join("\n"):r}if(function(e){return e instanceof Map}(e)&&(e=H(e)),function(e){return e&&"object"==typeof e&&e.constructor===Object}(e)||function(e){return e&&"object"==typeof e&&e.constructor===Array}(e)||function(e){try{const t=JSON.parse(e);return!!Object.keys(t).length}catch(t){return!1}return!0}(e)){try{e=f.decycle(e)}catch(n){}e=D(e,(({value:e})=>e instanceof Map?H(e):e));let r=JSON.stringify(e,null,t.beautify?4:0);return r=r.replace(/"([^"]+)":/g,"$1:").replace(/\uFFFF/g,'\\"'),t.highlight&&(r=u.highlight(r,{language:"js",theme:t.theme})),r}if(function(e){return"boolean"==typeof e}(e))return e?"true":"false";if(function(e){return e&&"[object Function]"==={}.toString.call(e)}(e))return""+e;let r="";try{e=f.decycle(e),r=JSON.stringify(e,null,t.beautify?4:0)}catch(n){try{r=e.toString()}catch(o){r=e}}return r}const I={};var R=function(e){"string"!=typeof e&&(e=F(e));const t=P(e).toString();return I[t]=e,t};const T={css:'s-request,[is="s-request"]{ display: none; }',exports:{_inlineProxyObj:void 0,async onBeforeMount(){this.component=new b.default(this.root,this.props,{interface:O});const e=this.root.querySelector("script");if(e){const t=_();let r=e.innerText.trim();r=r.replace(/^export default /,`window['s-request-script-${t}'] = `);const n=document.createElement("script");n.text=r,e.parentNode.insertBefore(n,e),e.remove(),this._inlineProxyObj=window[`s-request-script-${t}`]}this.component.props.cache&&(this._cache=new v.default("s-request")),this.root.request=this.request.bind(this),this.root.getData=this.getData.bind(this)},async getData(e){return this.request(e)},async request(e){var t,r,n;let o={type:null!=(t=this.component.props.type)?t:"get",url:this.component.props.url,data:e,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}};(null==(r=this._inlineProxyObj)?void 0:r.request)&&(o=this._inlineProxyObj.request(o));const i=R(o),c=new y.default(o);let s=await c.send();for(let u=0;u<2;u++)try{!1!==this.component.props.cache&&await this._cache.set(i,s.data,{ttl:"string"==typeof this.component.props.cache?this.component.props.cache:-1});break}catch(a){this._cache.clear()}return(null==(n=this._inlineProxyObj)?void 0:n.response)&&(s=this._inlineProxyObj.response(s)),s.data&&s.status&&s.headers&&(s=s.data),s},onMounted(){}},template:null,name:"s-request"};return h.register("s-request",T),function(e,t=null,r={}){const n=`${e} - ${_()}`;r=Object.assign({},{rootNode:document,once:!0},r),S[e]?S[e].push({id:n,selector:e,cb:t,settings:r}):S[e]=[{id:n,selector:e,cb:t,settings:r}],new p.default((({resolve:t,reject:n,emit:o})=>{function i(e,t){const r=S[t];r&&r.forEach((t=>{if(t.settings.once){if(e._querySelectorLive||(e._querySelectorLive={}),e._querySelectorLive[t.id])return;e._querySelectorLive[t.id]=!0}o("node",e),t.cb&&t.cb(e,(()=>{delete S[t.selector]}))}))}j||(j=new MutationObserver((e=>{e.forEach((e=>{e.addedNodes&&[].forEach.call(e.addedNodes,(e=>{const t=Object.keys(S);t.forEach((t=>{(function(e,t){if("#comment"==e.nodeName||"#text"==e.nodeName)return!1;const r=Element.prototype;return(r.matches||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector||function(e){return-1!==[].indexOf.call(document.querySelectorAll(e),this)}).call(e,t)})(e,t)&&i(e,t)})),e.querySelectorAll&&t.forEach((t=>{const r=e.querySelectorAll(t);[].forEach.call(r,(e=>{i(e,t)}))}))}))}))})),j.observe(r.rootNode,{childList:!0,subtree:!0})),[].forEach.call(r.rootNode.querySelectorAll(e),(t=>{i(t,e)}))}))}("s-request",(e=>{const t=e.id||"s-request-"+_();e.setAttribute("id",t),h.mount("#"+t)})),T.mount=()=>{h.mount("s-request")},window.env||(window.env={SUGAR:{}}),window.env.SUGAR=JSON.parse('{"ENVIRONMENT":"development"}'),T}));

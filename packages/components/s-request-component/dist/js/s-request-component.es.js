import*as t from"riot";import{v4 as e}from"uuid";import r from"@coffeekraken/s-promise";import n from"@coffeekraken/s-request";import o from"@coffeekraken/s-interface";import i from"@coffeekraken/s-component-utils";import s from"@coffeekraken/s-cache";import c from"chalk";import a from"copy-to";import{highlight as u}from"cli-highlight";import{decycle as f}from"json-cyclic";function l(){return e()}let h;const p={};class d extends o{}d.definition={method:{type:"String",values:["get","post"],default:"get"},url:{type:"String",required:!0},trigger:{type:"String",values:["event"],default:"event"},on:{type:"String"},cache:{type:"String|Boolean",default:!1}};var y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function g(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})})),e}var m,b={exports:{}},v={exports:{}},w=new Proxy({},{get(){throw new Error('Module "crypto" has been externalized for browser compatibility and cannot be accessed in client code.')}}),_=g(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:w}));v.exports=m=m||function(t,e){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==y&&y.crypto&&(r=y.crypto),!r&&"function"==typeof require)try{r=_}catch(g){}var n=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(g){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(g){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function t(){}return function(e){var r;return t.prototype=e,r=new t,t.prototype=null,r}}(),i={},s=i.lib={},c=s.Base={extend:function(t){var e=o(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=s.WordArray=c.extend({init:function(t,r){t=this.words=t||[],this.sigBytes=r!=e?r:4*t.length},toString:function(t){return(t||f).stringify(this)},concat:function(t){var e=this.words,r=t.words,n=this.sigBytes,o=t.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var s=r[i>>>2]>>>24-i%4*8&255;e[n+i>>>2]|=s<<24-(n+i)%4*8}else for(i=0;i<o;i+=4)e[n+i>>>2]=r[i>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,r=this.sigBytes;e[r>>>2]&=4294967295<<32-r%4*8,e.length=t.ceil(r/4)},clone:function(){var t=c.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],r=0;r<t;r+=4)e.push(n());return new a.init(e,t)}}),u=i.enc={},f=u.Hex={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],o=0;o<r;o++){var i=e[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n+=2)r[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new a.init(r,e/2)}},l=u.Latin1={stringify:function(t){for(var e=t.words,r=t.sigBytes,n=[],o=0;o<r;o++){var i=e[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(t){for(var e=t.length,r=[],n=0;n<e;n++)r[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new a.init(r,e)}},h=u.Utf8={stringify:function(t){try{return decodeURIComponent(escape(l.stringify(t)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(t){return l.parse(unescape(encodeURIComponent(t)))}},p=s.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=h.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var r,n=this._data,o=n.words,i=n.sigBytes,s=this.blockSize,c=i/(4*s),u=(c=e?t.ceil(c):t.max((0|c)-this._minBufferSize,0))*s,f=t.min(4*u,i);if(u){for(var l=0;l<u;l+=s)this._doProcessBlock(o,l);r=o.splice(0,u),n.sigBytes-=f}return new a.init(r,f)},clone:function(){var t=c.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});s.Hasher=p.extend({cfg:c.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function(t){return function(e,r){return new d.HMAC.init(t,r).finalize(e)}}});var d=i.algo={};return i}(Math);var j=b.exports=function(t){return function(e){var r=t,n=r.lib,o=n.WordArray,i=n.Hasher,s=r.algo,c=[];!function(){for(var t=0;t<64;t++)c[t]=4294967296*e.abs(e.sin(t+1))|0}();var a=s.MD5=i.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var r=0;r<16;r++){var n=e+r,o=t[n];t[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i=this._hash.words,s=t[e+0],a=t[e+1],p=t[e+2],d=t[e+3],y=t[e+4],g=t[e+5],m=t[e+6],b=t[e+7],v=t[e+8],w=t[e+9],_=t[e+10],j=t[e+11],S=t[e+12],O=t[e+13],x=t[e+14],q=t[e+15],B=i[0],k=i[1],A=i[2],M=i[3];B=u(B,k,A,M,s,7,c[0]),M=u(M,B,k,A,a,12,c[1]),A=u(A,M,B,k,p,17,c[2]),k=u(k,A,M,B,d,22,c[3]),B=u(B,k,A,M,y,7,c[4]),M=u(M,B,k,A,g,12,c[5]),A=u(A,M,B,k,m,17,c[6]),k=u(k,A,M,B,b,22,c[7]),B=u(B,k,A,M,v,7,c[8]),M=u(M,B,k,A,w,12,c[9]),A=u(A,M,B,k,_,17,c[10]),k=u(k,A,M,B,j,22,c[11]),B=u(B,k,A,M,S,7,c[12]),M=u(M,B,k,A,O,12,c[13]),A=u(A,M,B,k,x,17,c[14]),B=f(B,k=u(k,A,M,B,q,22,c[15]),A,M,a,5,c[16]),M=f(M,B,k,A,m,9,c[17]),A=f(A,M,B,k,j,14,c[18]),k=f(k,A,M,B,s,20,c[19]),B=f(B,k,A,M,g,5,c[20]),M=f(M,B,k,A,_,9,c[21]),A=f(A,M,B,k,q,14,c[22]),k=f(k,A,M,B,y,20,c[23]),B=f(B,k,A,M,w,5,c[24]),M=f(M,B,k,A,x,9,c[25]),A=f(A,M,B,k,d,14,c[26]),k=f(k,A,M,B,v,20,c[27]),B=f(B,k,A,M,O,5,c[28]),M=f(M,B,k,A,p,9,c[29]),A=f(A,M,B,k,b,14,c[30]),B=l(B,k=f(k,A,M,B,S,20,c[31]),A,M,g,4,c[32]),M=l(M,B,k,A,v,11,c[33]),A=l(A,M,B,k,j,16,c[34]),k=l(k,A,M,B,x,23,c[35]),B=l(B,k,A,M,a,4,c[36]),M=l(M,B,k,A,y,11,c[37]),A=l(A,M,B,k,b,16,c[38]),k=l(k,A,M,B,_,23,c[39]),B=l(B,k,A,M,O,4,c[40]),M=l(M,B,k,A,s,11,c[41]),A=l(A,M,B,k,d,16,c[42]),k=l(k,A,M,B,m,23,c[43]),B=l(B,k,A,M,w,4,c[44]),M=l(M,B,k,A,S,11,c[45]),A=l(A,M,B,k,q,16,c[46]),B=h(B,k=l(k,A,M,B,p,23,c[47]),A,M,s,6,c[48]),M=h(M,B,k,A,b,10,c[49]),A=h(A,M,B,k,x,15,c[50]),k=h(k,A,M,B,g,21,c[51]),B=h(B,k,A,M,S,6,c[52]),M=h(M,B,k,A,d,10,c[53]),A=h(A,M,B,k,_,15,c[54]),k=h(k,A,M,B,a,21,c[55]),B=h(B,k,A,M,v,6,c[56]),M=h(M,B,k,A,q,10,c[57]),A=h(A,M,B,k,m,15,c[58]),k=h(k,A,M,B,O,21,c[59]),B=h(B,k,A,M,y,6,c[60]),M=h(M,B,k,A,j,10,c[61]),A=h(A,M,B,k,p,15,c[62]),k=h(k,A,M,B,w,21,c[63]),i[0]=i[0]+B|0,i[1]=i[1]+k|0,i[2]=i[2]+A|0,i[3]=i[3]+M|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,o=8*t.sigBytes;r[o>>>5]|=128<<24-o%32;var i=e.floor(n/4294967296),s=n;r[15+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),r[14+(o+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),t.sigBytes=4*(r.length+1),this._process();for(var c=this._hash,a=c.words,u=0;u<4;u++){var f=a[u];a[u]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8)}return c},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});function u(t,e,r,n,o,i,s){var c=t+(e&r|~e&n)+o+s;return(c<<i|c>>>32-i)+e}function f(t,e,r,n,o,i,s){var c=t+(e&n|r&~n)+o+s;return(c<<i|c>>>32-i)+e}function l(t,e,r,n,o,i,s){var c=t+(e^r^n)+o+s;return(c<<i|c>>>32-i)+e}function h(t,e,r,n,o,i,s){var c=t+(r^(e|~n))+o+s;return(c<<i|c>>>32-i)+e}r.MD5=i._createHelper(a),r.HmacMD5=i._createHmacHelper(a)}(Math),t.MD5}(v.exports);function S(t){return!!t&&("object"==typeof t&&((!t.constructor||"Object"===t.constructor.name)&&("[object Object]"===Object.prototype.toString.call(t)&&t===Object(t))))}function O(t){const e=t.concat();for(let r=0;r<e.length;++r)for(let t=r+1;t<e.length;++t)e[r]===e[t]&&e.splice(t--,1);return e}function x(...t){const e={array:!1,object:!0};function r(t,n){const o={};if(!t&&n)return n;if(!n&&t)return t;if(!t&&!n)return{};a(t).override(o);for(const i of Object.keys(n))if(!0===e.array&&Array.isArray(t[i])&&Array.isArray(n[i])){const e=O([...t[i],...n[i]]);o[i]=e}else!0===e.object&&S(t[i])&&S(n[i])?o[i]=r(t[i],n[i]):a(n).pick(i).toCover(o);return o}const n=t[t.length-1]||{};(n.array&&"boolean"==typeof n.array||n.object&&"boolean"==typeof n.object)&&(void 0!==n.array&&(e.array=n.array),void 0!==n.object&&(e.object=n.object),t.pop());let o={};for(let i=0;i<t.length;i++){o=r(o,t[i]||{})}return o}function q(t,e,r={},n=[]){r=x({classInstances:!1,array:!0,privateProps:!1,cloneFirst:!0},r);const o=Array.isArray(t),i=o?[]:r.cloneFirst?Object.assign({},t):t;return Object.keys(t).forEach((s=>{if(!r.privateProps&&s.match(/^_/))return;if(S(t[s])||(c=t[s])&&"object"==typeof c&&(!c.constructor||"Object"!==c.constructor.name)&&"[object Object]"!==Object.prototype.toString.call(c)&&c.constructor!==Object&&r.classInstances||Array.isArray(t[s])&&r.array){const c=q(t[s],e,r,[...n,s]);return void(o?i.push(c):i[s]=c)}var c;const a=e({object:t,prop:s,value:t[s],path:[...n,s].join(".")});-1!==a?o?i.push(a):i[s]=a:delete t[s]})),i}function B(t){const e={};for(const[r,n]of t)e[r]=n;return e}function k(t,e={}){if(e=x({beautify:!0,highlight:!0,verbose:!0,theme:{number:c.yellow,default:c.white,keyword:c.blue,regexp:c.red,string:c.whiteBright,class:c.yellow,function:c.yellow,comment:c.gray,variable:c.red,attr:c.green}},e),"string"==typeof t)return t;if(null===t)return null;if(void 0===t)return;if(t instanceof Error){const r=t.toString(),n=t.stack,o=t.message;return e.verbose?[`<red>${t.constructor.name||"Error"}</red>`,"",o,"",n].join("\n"):r}if(function(t){return t instanceof Map}(t)&&(t=B(t)),function(t){return t&&"object"==typeof t&&t.constructor===Object}(t)||function(t){return t&&"object"==typeof t&&t.constructor===Array}(t)||function(t){try{const e=JSON.parse(t);return!!Object.keys(e).length}catch(e){return!1}return!0}(t)){try{t=f(t)}catch(n){}t=q(t,(({value:t})=>t instanceof Map?B(t):t));let r=JSON.stringify(t,null,e.beautify?4:0);return r=r.replace(/"([^"]+)":/g,"$1:").replace(/\uFFFF/g,'\\"'),e.highlight&&(r=u(r,{language:"js",theme:e.theme})),r}if(function(t){return"boolean"==typeof t}(t))return t?"true":"false";if(function(t){return t&&"[object Function]"==={}.toString.call(t)}(t))return""+t;let r="";try{t=f(t),r=JSON.stringify(t,null,e.beautify?4:0)}catch(n){try{r=t.toString()}catch(o){r=t}}return r}const A={};var M=function(t){"string"!=typeof t&&(t=k(t));const e=j(t).toString();return A[e]=t,e};const E={css:'s-request,[is="s-request"]{ display: none; }',exports:{_inlineProxyObj:void 0,async onBeforeMount(){this.component=new i(this.root,this.props,{interface:d});const t=this.root.querySelector("script");if(t){const e=l();let r=t.innerText.trim();r=r.replace(/^export default /,`window['s-request-script-${e}'] = `);const n=document.createElement("script");n.text=r,t.parentNode.insertBefore(n,t),t.remove(),this._inlineProxyObj=window[`s-request-script-${e}`]}this.component.props.cache&&(this._cache=new s("s-request")),this.root.request=this.request.bind(this),this.root.getData=this.getData.bind(this)},async getData(t){return this.request(t)},async request(t){var e,r,o;let i={type:null!=(e=this.component.props.type)?e:"get",url:this.component.props.url,data:t,headers:{"Cache-Control":"no-cache",Pragma:"no-cache",Expires:"0"}};(null==(r=this._inlineProxyObj)?void 0:r.request)&&(i=this._inlineProxyObj.request(i));const s=M(i),c=new n(i);let a=await c.send();for(let n=0;n<2;n++)try{!1!==this.component.props.cache&&await this._cache.set(s,a.data,{ttl:"string"==typeof this.component.props.cache?this.component.props.cache:-1});break}catch(u){this._cache.clear()}return(null==(o=this._inlineProxyObj)?void 0:o.response)&&(a=this._inlineProxyObj.response(a)),a.data&&a.status&&a.headers&&(a=a.data),a},onMounted(){}},template:null,name:"s-request"};t.register("s-request",E),function(t,e=null,n={}){const o=`${t} - ${l()}`;n=Object.assign({},{rootNode:document,once:!0},n),p[t]?p[t].push({id:o,selector:t,cb:e,settings:n}):p[t]=[{id:o,selector:t,cb:e,settings:n}],new r((({resolve:e,reject:r,emit:o})=>{function i(t,e){const r=p[e];r&&r.forEach((e=>{if(e.settings.once){if(t._querySelectorLive||(t._querySelectorLive={}),t._querySelectorLive[e.id])return;t._querySelectorLive[e.id]=!0}o("node",t),e.cb&&e.cb(t,(()=>{delete p[e.selector]}))}))}h||(h=new MutationObserver((t=>{t.forEach((t=>{t.addedNodes&&[].forEach.call(t.addedNodes,(t=>{const e=Object.keys(p);e.forEach((e=>{(function(t,e){if("#comment"==t.nodeName||"#text"==t.nodeName)return!1;const r=Element.prototype;return(r.matches||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector||function(t){return-1!==[].indexOf.call(document.querySelectorAll(t),this)}).call(t,e)})(t,e)&&i(t,e)})),t.querySelectorAll&&e.forEach((e=>{const r=t.querySelectorAll(e);[].forEach.call(r,(t=>{i(t,e)}))}))}))}))})),h.observe(n.rootNode,{childList:!0,subtree:!0})),[].forEach.call(n.rootNode.querySelectorAll(t),(e=>{i(e,t)}))}))}("s-request",(e=>{const r=e.id||"s-request-"+l();e.setAttribute("id",r),t.mount("#"+r)})),E.mount=()=>{t.mount("s-request")},window.env||(window.env={SUGAR:{}}),window.env.SUGAR=JSON.parse('{"ENVIRONMENT":"development"}');export default E;

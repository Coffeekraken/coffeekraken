{% set ogObj = {} %}
{% if metas and metas.og %}
    {% set ogObj = metas.og %}
{% endif %}

{% if frontspec.metas.og %}
    {% set ogObj = frontspec.metas.og|__toArray|merge(ogObj) %}
{% endif %}

{% if not metas %}
    {% set metas = [] %}
{% endif %}

{% set metasObj = metas %}
{% if frontspec.metas %}
    {% set metasObj = frontspec.metas|__toArray|merge(metas) %}
{% endif %}

{% set lang = 'en' %}
{% if metas.lang %}
    {% set lang = metas.lang %}
{% elseif frontspec.metas.lang %}
    {% set lang = frontspec.metas.lang %}
{% endif %}

{% set dir = 'ltr' %}
{% if metas.dir %}
    {% set dir = metas.dir %}
{% elseif frontspec.metas.dir %}
    {% set dir = frontspec.metas.dir %}
{% endif %}

{% set lodClasses = '' %}
{% if frontspec.lod.enabled %}
    {% set lodClasses = __lodClasses(frontspec.lod.defaultLevel ? frontspec.lod.defaultLevel : 3) %}
{% endif %}

<!DOCTYPE html>
<html lang="{{ lang }}" dir="{{ dir }}" class="{{ lodClasses }}">
<head>
    <!-- metas -->
    {{ __frontspecMetas(frontspec)|raw }}
    
    <!-- og -->
    {{ __frontspecOg(frontspec|__toObject)|raw }}
    
    <!-- assets -->
    {% set cacheBuster = '' %}
    {% if shared.server.sessionId %}
        {% set cacheBuster = shared.server.sessionId %}
    {% endif %}
    {{ __frontspecAssets(frontspec, cacheBuster)|raw }}
    
    {# SDashboard #}
    {% if app.request.server.get('ENV') != 'production' %}
        <!-- SDashboard -->
        <script src="/sugar/dashboard/lazy.js" type="module" defer></script>
    {% endif %}

    <!-- favicon -->
    {{ __frontspecFavicon(frontspec)|raw }}

    {% block head %}{% endblock %}

</head>
<body class="{{ bodyAttributes.class }} initial-loading loading" s-sugar {{ __attrs(bodyAttributes, ['class'])|raw }}>
    {% if page and page.uid %}
        {{ __pageDataTemplate(page)|raw }}
    {% endif %}

    {% if sugar or frontspec or env %}
    <script id="sugar-override">
        if (!document.env) document.env = {};
        {% if env %}
            document.env = {
                ...document.env,
                ...{{ env|json_encode()|raw }}
            };
        {% endif %}
        {% if sugar %}
            document.env.SUGAR = {{ sugar|json_encode()|raw }};
        {% endif %}
        {% if frontspec %}
            document.env.FRONTSPEC = {{ __deepDiff(__readFrontspec(), frontspec)|json_encode()|raw }};
        {% endif %}
        {% if classmap %}
            document.env.CLASSMAP = {{ __deepDiff(__readClassmap(), classmap)|json_encode()|raw }};
        {% endif %}
    </script>
    {% endif %}

    {% block body %}{% endblock %}

    {% if carpenter %}
        <s-carpenter id="carpenter"></s-carpenter>
    {% endif %}

</body>
</html>

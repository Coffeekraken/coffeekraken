{"version":3,"sources":["SBuildViewsActionsStream.js"],"names":["__SActionsStream","require","__deepMerge","__SFsFilesResolverStreamAction","__SFsReadFileStreamAction","__SFsUnlinkStreamAction","__globParent","__SFsOutputStreamAction","__path","module","exports","settings","unlink","filesResolver","readFile","fsOutput","name","actions","ignoreFolders","out","before","streamObj","inputDir","input","outputDir","beforeActions","outputPath","replace","slice","outputStack","data","resolve"],"mappings":";;;;;;;;;;;;;;;;;;AAAA,MAAMA,gBAAgB,GAAGC,OAAO,CAAC,6BAAD,CAAhC;;AACA,MAAMC,WAAW,GAAGD,OAAO,CAAC,wBAAD,CAA3B;;AACA,MAAME,8BAA8B,GAAGF,OAAO,CAAC,mDAAD,CAA9C;;AACA,MAAMG,yBAAyB,GAAGH,OAAO,CAAC,8CAAD,CAAzC;;AACA,MAAMI,uBAAuB,GAAGJ,OAAO,CAAC,4CAAD,CAAvC;;AACA,MAAMK,YAAY,GAAGL,OAAO,CAAC,aAAD,CAA5B;;AACA,MAAMM,uBAAuB,GAAGN,OAAO,CAAC,4CAAD,CAAvC;;AACA,MAAMO,MAAM,GAAGP,OAAO,CAAC,MAAD,CAAtB;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyBAQ,MAAM,CAACC,OAAP;AAAA;;AAAA;;AACE;;;;;;;;;AASA,oCAAYC,QAAZ,EAA2B;AAAA,QAAfA,QAAe;AAAfA,MAAAA,QAAe,GAAJ,EAAI;AAAA;;AAAA;;AACzB;AADyB,6BAGvB;AACEC,MAAAA,MAAM,EAAEP,uBADV;AAEEQ,MAAAA,aAAa,EAAEV,8BAFjB;AAGEW,MAAAA,QAAQ,EAAEV,yBAHZ;AAIEW,MAAAA,QAAQ,EAAER;AAJZ,KAHuB,EASvBL,WAAW,CACT;AACEc,MAAAA,IAAI,EAAE,aADR;AAEEC,MAAAA,OAAO,EAAE;AACPJ,QAAAA,aAAa,EAAE;AACbK,UAAAA,aAAa,EAAE,EADF;AAEbC,UAAAA,GAAG,EAAE;AAFQ;AADR,OAFX;AAQEC,MAAAA,MAAM,EAAGC,SAAD,IAAe;AACrBA,QAAAA,SAAS,CAACC,QAAV,GAAqBhB,YAAY,CAACe,SAAS,CAACE,KAAX,CAAjC;AACAF,QAAAA,SAAS,CAACT,MAAV,GAAmBS,SAAS,CAACG,SAA7B;AACA,eAAOH,SAAP;AACD,OAZH;AAaEI,MAAAA,aAAa,EAAE;AACbV,QAAAA,QAAQ,EAAGM,SAAD,IAAe;AACvB,cAAIK,UAAU,GAAGL,SAAS,CAACE,KAAV,CAAgBI,OAAhB,CAAwBN,SAAS,CAACC,QAAlC,EAA4C,EAA5C,CAAjB;AACA,cAAII,UAAU,CAACE,KAAX,CAAiB,CAAjB,EAAoB,CAApB,MAA2B,GAA/B,EACEF,UAAU,GAAGA,UAAU,CAACE,KAAX,CAAiB,CAAjB,CAAb;AAEF,cAAI,CAACP,SAAS,CAACQ,WAAf,EAA4BR,SAAS,CAACQ,WAAV,GAAwB,EAAxB;;AAC5B,cAAIR,SAAS,CAACG,SAAV,IAAuBE,UAAvB,IAAqCL,SAAS,CAACS,IAAnD,EAAyD;AACvDT,YAAAA,SAAS,CAACQ,WAAV,CAAsBC,IAAtB,GAA6BtB,MAAM,CAACuB,OAAP,CAC3BV,SAAS,CAACG,SADiB,EAE3BE,UAF2B,CAA7B;AAID;;AACD,iBAAOL,SAAP;AACD;AAdY;AAbjB,KADS,EA+BTV,QA/BS,CATY;AA2C1B;;AArDH;AAAA,EAAwDX,gBAAxD","sourcesContent":["const __SActionsStream = require('../../stream/SActionsStream');\nconst __deepMerge = require('../../object/deepMerge');\nconst __SFsFilesResolverStreamAction = require('../../stream/actions/SFsFilesResolverStreamAction');\nconst __SFsReadFileStreamAction = require('../../stream/actions/SFsReadFileStreamAction');\nconst __SFsUnlinkStreamAction = require('../../stream/actions/SFsUnlinkStreamAction');\nconst __globParent = require('glob-parent');\nconst __SFsOutputStreamAction = require('../../stream/actions/SFsOutputStreamAction');\nconst __path = require('path');\n\n/**\n * @name            SBuildViewsActionsStream\n * @namespace           node.build.views\n * @type            Class\n * @extends         SActionsStream\n *\n * This class represent a pre-configured action stream to build easily some javascript files\n *\n * @param           {Object}Â          [settings={}]         The settings object to configure your instance\n *\n * @todo        Document the streamObj required properties\n *\n * @example         js\n * const SBuildViewsActionsStream = require('@coffeekraken/sugar/node/build/views/SBuildViewsActionsStream');\n * const myStream = new SBuildViewsActionsStream();\n * myStream.start({\n *    input: '...',\n *    output: '...'\n * }).on('resolve', (result) => {\n *    // do something\n * });\n *\n * @since     2.0.0\n * @author    Olivier Bossel <olivier.bossel@gmail.com> (https://olivierbossel.com)\n */\nmodule.exports = class SBuildViewsActionsStream extends __SActionsStream {\n  /**\n   * @name        constructor\n   * @type        Function\n   * @constructor\n   *\n   * Constructor\n   *\n   * @author    Olivier Bossel <olivier.bossel@gmail.com> (https://olivierbossel.com)\n   */\n  constructor(settings = {}) {\n    // init actions stream\n    super(\n      {\n        unlink: __SFsUnlinkStreamAction,\n        filesResolver: __SFsFilesResolverStreamAction,\n        readFile: __SFsReadFileStreamAction,\n        fsOutput: __SFsOutputStreamAction\n      },\n      __deepMerge(\n        {\n          name: 'Build Views',\n          actions: {\n            filesResolver: {\n              ignoreFolders: [],\n              out: 'array'\n            }\n          },\n          before: (streamObj) => {\n            streamObj.inputDir = __globParent(streamObj.input);\n            streamObj.unlink = streamObj.outputDir;\n            return streamObj;\n          },\n          beforeActions: {\n            fsOutput: (streamObj) => {\n              let outputPath = streamObj.input.replace(streamObj.inputDir, '');\n              if (outputPath.slice(0, 1) === '/')\n                outputPath = outputPath.slice(1);\n\n              if (!streamObj.outputStack) streamObj.outputStack = {};\n              if (streamObj.outputDir && outputPath && streamObj.data) {\n                streamObj.outputStack.data = __path.resolve(\n                  streamObj.outputDir,\n                  outputPath\n                );\n              }\n              return streamObj;\n            }\n          }\n        },\n        settings\n      )\n    );\n  }\n};\n"]}
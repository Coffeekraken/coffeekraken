{"version":3,"sources":["downloadFile.js"],"names":["__downloadsFolder","require","__path","__download","module","exports","downloadUrl","destinationPath","callback","Promise","resolve","reject","fileStreamDest","parsedDestinationPath","parse","parsedDownloadUrl","ext","destination","slice","base","directory","dir","filename","err"],"mappings":";;AAAA,MAAMA,iBAAiB,GAAGC,OAAO,CAAC,kBAAD,CAAjC;;AACA,MAAMC,MAAM,GAAGD,OAAO,CAAC,MAAD,CAAtB;;AACA,MAAME,UAAU,GAAGF,OAAO,CAAC,eAAD,CAA1B,C,CAEA;;AAEA;;;;;;;;;;;;;;;;;;;;;;AAoBAG,MAAM,CAACC,OAAP,GAAiB,UACfC,WADe,EAEfC,eAFe,EAGfC,QAHe,EAIf;AAAA,MAFAD,eAEA;AAFAA,IAAAA,eAEA,GAFkBP,iBAAiB,EAEnC;AAAA;;AAAA,MADAQ,QACA;AADAA,IAAAA,QACA,GADW,IACX;AAAA;;AACA,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,QAAIC,cAAJ;;AACA,QAAIC,qBAAqB,GAAGX,MAAM,CAACY,KAAP,CAAaP,eAAb,CAA5B;;AACA,QAAIQ,iBAAiB,GAAGb,MAAM,CAACY,KAAP,CAAaR,WAAb,CAAxB;;AAEA,QAAIO,qBAAqB,CAACG,GAA1B,EAA+B;AAC7BJ,MAAAA,cAAc,GAAGK,WAAjB;AACD,KAFD,MAEO,IAAIV,eAAe,CAACW,KAAhB,CAAsB,CAAC,CAAvB,MAA8B,GAA9B,IAAqCH,iBAAiB,CAACI,IAA3D,EAAiE;AACtEP,MAAAA,cAAc,GAAGL,eAAe,GAAGQ,iBAAiB,CAACI,IAArD;AACD,KAFM,MAEA,IAAIJ,iBAAiB,CAACI,IAAtB,EAA4B;AACjCP,MAAAA,cAAc,GAAI,GAAEL,eAAgB,IAAGQ,iBAAiB,CAACI,IAAK,EAA9D;AACD,KAXqC,CAatC;;;AACAhB,IAAAA,UAAU,CACRG,WADQ,EAER;AACEc,MAAAA,SAAS,EAAElB,MAAM,CAACY,KAAP,CAAaF,cAAb,EAA6BS,GAD1C;AAEEC,MAAAA,QAAQ,EAAEpB,MAAM,CAACY,KAAP,CAAaF,cAAb,EAA6BO;AAFzC,KAFQ,EAMR,UAAUI,GAAV,EAAe;AACb,UAAIA,GAAJ,EAAS;AACPZ,QAAAA,MAAM,CAACY,GAAD,CAAN;AACA,YAAIf,QAAJ,EAAc,OAAOA,QAAQ,CAACe,GAAD,CAAf;AACd;AACD;;AACDb,MAAAA,OAAO,CAACE,cAAD,CAAP;AACA,UAAIJ,QAAJ,EAAc,OAAOA,QAAQ,CAACI,cAAD,CAAf;AACf,KAdO,CAAV;AAgBD,GA9BM,CAAP;AA+BD,CApCD","sourcesContent":["const __downloadsFolder = require('downloads-folder');\nconst __path = require('path');\nconst __download = require('download-file');\n\n// TODO tests\n\n/**\n * @name              downloadFile\n * @namespace           node.fs\n * @type              Function\n *\n * Download a file and save it on the file system\n *\n * @param             {String}          downloadUrl             The absolute url to the file that you want to download\n * @param             {String}          [destinationPath=__downloadsFolder()]         The path where you want to save the file. Can be a simple directory path or an absolute file path with the file name and the extension\n * @param             {Function}        [callback=null]           A callback function to call on success or on error. In case of success it will take as parameter the final file path on the file system, otherwise it will be the error passed\n * @return            {Promise}                                 A promise that will be resolved with the final absolute file path, or rejected with the error passed\n *\n * @example       js\n * const downloadFile = require('@coffeekraken/node/fs/downloadFile');\n * downloadFile('https://myCoolFileUrl.ch/coco.json').then((dest) => {\n *    console.log('file downloeaded and saved here', dest);\n * }).catch(err) => {});\n *\n * @author \t\tOlivier Bossel <olivier.bossel@gmail.com> (https://olivierbossel.com)\n */\nmodule.exports = function (\n  downloadUrl,\n  destinationPath = __downloadsFolder(),\n  callback = null\n) {\n  return new Promise((resolve, reject) => {\n    let fileStreamDest;\n    let parsedDestinationPath = __path.parse(destinationPath);\n    let parsedDownloadUrl = __path.parse(downloadUrl);\n\n    if (parsedDestinationPath.ext) {\n      fileStreamDest = destination;\n    } else if (destinationPath.slice(-1) === '/' && parsedDownloadUrl.base) {\n      fileStreamDest = destinationPath + parsedDownloadUrl.base;\n    } else if (parsedDownloadUrl.base) {\n      fileStreamDest = `${destinationPath}/${parsedDownloadUrl.base}`;\n    }\n\n    // download the file\n    __download(\n      downloadUrl,\n      {\n        directory: __path.parse(fileStreamDest).dir,\n        filename: __path.parse(fileStreamDest).base\n      },\n      function (err) {\n        if (err) {\n          reject(err);\n          if (callback) return callback(err);\n          return;\n        }\n        resolve(fileStreamDest);\n        if (callback) return callback(fileStreamDest);\n      }\n    );\n  });\n};\n"]}
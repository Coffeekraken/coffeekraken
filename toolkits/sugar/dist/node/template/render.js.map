{"version":3,"sources":["render.js"],"names":["__sugarConfig","require","__getFilename","__fs","__path","__getExt","module","exports","viewPath","data","settings","engines","rootDir","viewDir","Object","keys","forEach","ext","replace","split","join","viewName","trim","folderPath","viewToCompile","readdirSync","resolve","filter","file","filename","slice","viewToCompileExt","viewToCompileWithoutExt","jsFilePath","jsonFilePath","existsSync","engineFn","toLowerCase","Error","result","render"],"mappings":";;;;;;AAAA,IAAMA,aAAa,GAAGC,OAAO,CAAC,iBAAD,CAA7B;;AACA,IAAMC,aAAa,GAAGD,OAAO,CAAC,gBAAD,CAA7B;;AACA,IAAME,IAAI,GAAGF,OAAO,CAAC,IAAD,CAApB;;AACA,IAAMG,MAAM,GAAGH,OAAO,CAAC,MAAD,CAAtB;;AACA,IAAMI,QAAQ,GAAGJ,OAAO,CAAC,iBAAD,CAAxB;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;AAwBAK,MAAM,CAACC,OAAP;AAAA,kCAAiB,WAAsBC,QAAtB,EAAgCC,IAAhC,EAA6CC,QAA7C,EAA4D;AAAA,QAA5BD,IAA4B;AAA5BA,MAAAA,IAA4B,GAArB,IAAqB;AAAA;;AAAA,QAAfC,QAAe;AAAfA,MAAAA,QAAe,GAAJ,EAAI;AAAA;;AAC3E,QAAMC,OAAO,GAAG;AACd,mBAAaV,OAAO,CAAC,YAAD;AADN,KAAhB,CAD2E,CAK3E;;AACA,QAAMW,OAAO,GAAGZ,aAAa,CAAC,eAAD,CAA7B;;AACA,QAAIa,OAAO,GAAGL,QAAd;AACAM,IAAAA,MAAM,CAACC,IAAP,CAAYJ,OAAZ,EAAqBK,OAArB,CAA8BC,GAAD,IAAS;AACpCJ,MAAAA,OAAO,GAAGA,OAAO,CAACK,OAAR,YAAoBD,GAApB,GAA2B,EAA3B,CAAV;AACD,KAFD;AAGAJ,IAAAA,OAAO,GAAGA,OAAO,CAACM,KAAR,CAAc,GAAd,EAAmBC,IAAnB,CAAwB,GAAxB,CAAV;;AACA,QAAMC,QAAQ,GAAGnB,aAAa,CAACW,OAAD,CAAb,CAAuBS,IAAvB,EAAjB;;AACA,QAAMC,UAAU,GAAGV,OAAO,CAACK,OAAR,CAAgBG,QAAhB,EAA0B,EAA1B,EAA8BC,IAA9B,EAAnB,CAb2E,CAe3E;;AACA,QAAME,aAAa,aAAMD,UAAN,SACjBpB,IAAI,CAACsB,WAAL,CAAiBrB,MAAM,CAACsB,OAAP,CAAed,OAAf,EAAwBW,UAAxB,CAAjB,EAAsDI,MAAtD,CAA8DC,IAAD,IAAU;AACrE;AACA,UAAMC,QAAQ,GAAG3B,aAAa,CAAC0B,IAAD,CAA9B;;AACA,UAAMX,GAAG,GAAGY,QAAQ,CAACV,KAAT,CAAe,GAAf,EAAoBW,KAApB,CAA0B,CAA1B,EAA6BV,IAA7B,CAAkC,GAAlC,CAAZ;;AACA,UAAIC,QAAQ,KAAKQ,QAAQ,CAACX,OAAT,YAAqBD,GAArB,GAA4B,EAA5B,CAAjB,EAAkD;AAChD,eAAO,IAAP;AACD;;AACD,aAAO,KAAP;AACD,KARD,EAQG,CARH,CADiB,CAAnB;AAYA,QAAMc,gBAAgB,GAAGP,aAAa,CAACL,KAAd,CAAoB,GAApB,EAAyBW,KAAzB,CAA+B,CAA/B,EAAkCV,IAAlC,CAAuC,GAAvC,CAAzB;AACA,QAAMY,uBAAuB,GAAGR,aAAa,CAACN,OAAd,YAC1Ba,gBAD0B,GAE9B,EAF8B,CAAhC,CA7B2E,CAkC3E;AACA;;AACA,QAAI,CAACtB,IAAL,EAAW;AACT,UAAMwB,UAAU,GAAG7B,MAAM,CAACsB,OAAP,CAAed,OAAf,EAAwBoB,uBAAxB,IAAmD,KAAtE;AACA,UAAME,YAAY,GAChB9B,MAAM,CAACsB,OAAP,CAAed,OAAf,EAAwBoB,uBAAxB,IAAmD,OADrD;;AAEA,UAAI7B,IAAI,CAACgC,UAAL,CAAgBF,UAAhB,CAAJ,EAAiC;AAC/BxB,QAAAA,IAAI,GAAGR,OAAO,CAACgC,UAAD,CAAd;AACD,OAFD,MAEO,IAAI9B,IAAI,CAACgC,UAAL,CAAgBD,YAAhB,CAAJ,EAAmC;AACxCzB,QAAAA,IAAI,GAAGR,OAAO,CAACiC,YAAD,CAAd;AACD;AACF,KA7C0E,CA+C3E;;;AACA,QAAME,QAAQ,GAAGzB,OAAO,CAACoB,gBAAgB,CAACM,WAAjB,EAAD,CAAxB;;AACA,QAAI,CAACD,QAAL,EAAe;AACb,YAAM,IAAIE,KAAJ,iDACoCd,aADpC,wHAC6JV,MAAM,CAACC,IAAP,CAC/JJ,OAD+J,EAE/JS,IAF+J,CAE1J,IAF0J,CAD7J,kBAAN;AAKD,KAvD0E,CAyD3E;;;AACA,QAAMmB,MAAM,SAASH,QAAQ,CAACZ,aAAD,EAAgBf,IAAhB,EAAsBC,QAAtB,CAA7B,CA1D2E,CA4D3E;;AACA,WAAO6B,MAAP;AACD,GA9DD;;AAAA,WAAgCC,MAAhC;AAAA;AAAA;;AAAA,SAAgCA,MAAhC;AAAA","sourcesContent":["const __sugarConfig = require('../config/sugar');\nconst __getFilename = require('../fs/filename');\nconst __fs = require('fs');\nconst __path = require('path');\nconst __getExt = require('../fs/extension');\n\n/**\n * @name              render\n * @namespace         node.template\n * @type              Function\n * @async\n *\n * This function take a view path, a data object and optionaly a settings object to compile\n * the view and return a simple Promise that will be resolved or rejected depending on the\n * process status.\n *\n * @param       {String}        viewPath        The view path to compile. This has to be a dotted path like \"my.cool.view\" relative to the @config.views.rootDir directory\n * @param       {Object}        [data={}]       An object of data to use to compile the view correctly\n * @param       {Object}        [settings={}]   An object of settings to configure your rendering process. Here's the list of available settings:\n * - No settings for now...\n *\n * @example       js\n * const render = require('@coffeekraken/sugar/node/template/render');\n * const result = await render('my.cool.template, {\n *    hello: 'world'\n * });\n *\n * @since     2.0.0\n * @author    Olivier Bossel <olivier.bossel@gmail.com> (https://olivierbossel.com)\n */\nmodule.exports = async function render(viewPath, data = null, settings = {}) {\n  const engines = {\n    'blade.php': require('./bladePhp')\n  };\n\n  // listing the files available in the passed view folder\n  const rootDir = __sugarConfig('views.rootDir');\n  let viewDir = viewPath;\n  Object.keys(engines).forEach((ext) => {\n    viewDir = viewDir.replace(`.${ext}`, '');\n  });\n  viewDir = viewDir.split('.').join('/');\n  const viewName = __getFilename(viewDir).trim();\n  const folderPath = viewDir.replace(viewName, '').trim();\n\n  // list all the files in the folder\n  const viewToCompile = `${folderPath}${\n    __fs.readdirSync(__path.resolve(rootDir, folderPath)).filter((file) => {\n      // get the filename\n      const filename = __getFilename(file);\n      const ext = filename.split('.').slice(1).join('.');\n      if (viewName === filename.replace(`.${ext}`, '')) {\n        return true;\n      }\n      return false;\n    })[0]\n  }`;\n\n  const viewToCompileExt = viewToCompile.split('.').slice(1).join('.');\n  const viewToCompileWithoutExt = viewToCompile.replace(\n    `.${viewToCompileExt}`,\n    ''\n  );\n\n  // check if we don't have data passed to check if we can\n  // grab them from a json or js file\n  if (!data) {\n    const jsFilePath = __path.resolve(rootDir, viewToCompileWithoutExt) + '.js';\n    const jsonFilePath =\n      __path.resolve(rootDir, viewToCompileWithoutExt) + '.json';\n    if (__fs.existsSync(jsFilePath)) {\n      data = require(jsFilePath);\n    } else if (__fs.existsSync(jsonFilePath)) {\n      data = require(jsonFilePath);\n    }\n  }\n\n  // get the engine to compile the view\n  const engineFn = engines[viewToCompileExt.toLowerCase()];\n  if (!engineFn) {\n    throw new Error(\n      `You try to render the view \"<primary>${viewToCompile}</primary>\" but these kind of views are not supported yet. Please use one of these views formats: \"<cyan>${Object.keys(\n        engines\n      ).join(', ')}</cyan>\"...`\n    );\n  }\n\n  // process to the rendering\n  const result = await engineFn(viewToCompile, data, settings);\n\n  // return the result\n  return result;\n};\n"]}
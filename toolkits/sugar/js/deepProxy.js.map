{
    "version": 3,
    "sources": [
        "deepProxy.js"
    ],
    "names": [
        "deepProxy",
        "object",
        "handlerFn",
        "settings",
        "preproxy",
        "WeakMap",
        "isRevoked",
        "deep",
        "handleSet",
        "handleGet",
        "handleDelete",
        "makeHandler",
        "path",
        "set",
        "target",
        "key",
        "value",
        "proxify",
        "oldValue",
        "join",
        "action",
        "fullAction",
        "get",
        "receiver",
        "Reflect",
        "has",
        "revoke",
        "undefined",
        "deleteProperty",
        "deleted",
        "obj",
        "Array",
        "isArray",
        "watch",
        "Object",
        "getOwnPropertyNames",
        "prototype",
        "watchObj",
        "keys",
        "p",
        "Proxy",
        "revocable",
        "revokePropertyObj",
        "writable",
        "configurable",
        "enumerable",
        "__copy",
        "proxy",
        "val",
        "setTimeout",
        "defineProperties"
    ],
    "mappings": "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",
    "sourcesContent": [
        "import __proxy from '../array/proxy';\nimport __deepMap from '../object/deepMap';\nimport __clone from '../object/clone';\nimport __delete from '../object/delete';\nimport __deepMerge from '../object/deepMerge';\n\n/**\n * @name                            deepProxy\n * @namespace           sugar.js.object\n * @type                            Function\n *\n * This function allows you to add Proxy to an object in deep fashion.\n * Normally the Proxy process only the level on which it has been added. Here we add Proxy to all the\n * object levels and to new properties as well.\n *\n * On the returned proxied object, you will have access to the ```revoke``` method that you can call to revoke the proxy applied.\n * This method will return you a shallow version of the proxied object that you can use as you want\n *\n * @param          {Object}                 object            The object on which to add the proxy\n * @param           {Function}                handlerFn       The handler function that will be called with the update object. It can be a property deleted, an array item added, a property updated, etc...:\n * - set: An object property added or updated\n * - delete: An object property deleted\n * - push: An item has been added inside an array\n * - {methodName}: Every array actions\n * @param         {Object}Â                [settings={}]         An object of settings to configure your proxy:\n * - deep (true) {Boolean}: Specify if you want to watch the passed object deeply or juste the first level\n * - handleSet (true) {Boolean}: Specify if you want to handle the \"set\" action\n * - handleGet (false) {Boolean}: Specify if you want to handle the \"get\" action\n * - handleDelete (true) {Boolean}: Specify if you want to handle the \"delete\" action\n * @return          {Object}                                  The proxied object\n *\n * @example           js\n * import deepProxy from '@coffeekraken/sugar/js/object/deepProxy';\n * const a = deepProxy({\n *    hello: 'world'\n * }, (actionObj) => {\n *    // do something with the actionObj...\n * });\n * a.hello = 'coco';\n *\n * @author  Olivier Bossel <olivier.bossel@gmail.com> (https://olivierbossel.com)\n */\nexport default function deepProxy(object, handlerFn, settings = {}) {\n  const preproxy = new WeakMap();\n  let isRevoked = false;\n  settings = __deepMerge(\n    {\n      deep: true,\n      handleSet: true,\n      handleGet: false,\n      handleDelete: true\n    },\n    settings\n  );\n\n  function makeHandler(path) {\n    return {\n      set(target, key, value) {\n        if (isRevoked || !settings.handleSet) return true;\n\n        if (settings.deep && typeof value === 'object') {\n          value = proxify(value, [...path, key]);\n        }\n\n        const oldValue = target[key];\n\n        target[key] = value;\n\n        handlerFn({\n          object,\n          target,\n          key,\n          path: [...path, key].join('.'),\n          action: 'set',\n          fullAction: `Object.set`,\n          oldValue,\n          value\n        });\n\n        return true;\n      },\n\n      get(target, key, receiver) {\n        if (Reflect.has(target, key)) {\n          if (!settings.handleGet) return target[key];\n\n          const value = handlerFn({\n            object,\n            target,\n            key,\n            path: [...path, key].join('.'),\n            action: 'get',\n            fullAction: 'Object.get'\n          });\n          if (key === 'revoke') return receiver.revoke;\n          if (value === undefined) return target[key];\n          return value;\n        }\n        return undefined;\n      },\n\n      deleteProperty(target, key) {\n        if (isRevoked || !settings.handleDelete) return true;\n\n        if (Reflect.has(target, key)) {\n          // unproxy(target, key);\n          const oldValue = target[key];\n          let deleted = Reflect.deleteProperty(target, key);\n          if (deleted) {\n            handlerFn({\n              object,\n              target,\n              key,\n              path: [...path, key].join('.'),\n              action: 'delete',\n              fullAction: 'Object.delete',\n              oldValue\n            });\n          }\n          return deleted;\n        }\n        return false;\n      }\n    };\n  }\n\n  function proxify(obj, path) {\n    if (obj === null) return obj;\n\n    if (settings.deep) {\n      for (let key of Object.keys(obj)) {\n        if (Array.isArray(obj[key])) {\n          obj[key] = __proxy(obj[key]);\n          obj[key].watch(\n            Object.getOwnPropertyNames(Array.prototype),\n            (watchObj) => {\n              handlerFn({\n                path: [...path, key].join('.'),\n                ...watchObj\n              });\n            }\n          );\n        } else if (typeof obj[key] === 'object') {\n          obj[key] = proxify(obj[key], [...path, key]);\n        }\n      }\n    }\n\n    let p = Proxy.revocable(obj, makeHandler(path));\n\n    // preproxy.set(p, obj);\n    const revokePropertyObj = {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: () => {\n        // make a shallow copy of the proxy object\n        let __copy = __clone(p.proxy, true);\n        // mark the proxy as revoked\n        isRevoked = true;\n        // sanitize the copy\n        __copy = __deepMap(__copy, (val, key, path) => {\n          // console.log(path);\n          if (key === 'revoke' && typeof val === 'function') {\n            return -1;\n          }\n          return val;\n        });\n        // deep revoke the proxies\n        setTimeout(() => {\n          __deepMap(\n            p.proxy,\n            (val, key, path) => {\n              if (key === 'revoke' && typeof val === 'function') {\n                val();\n              }\n            },\n            {}\n          );\n          // revoke the proxy at first level\n          p.revoke();\n        });\n        // return the shallow copy\n        return __copy;\n      }\n    };\n    if (Array.isArray(p.proxy)) {\n      p.proxy.revoke = revokePropertyObj.value;\n    } else {\n      Object.defineProperties(p.proxy, {\n        revoke: revokePropertyObj\n      });\n    }\n    return p.proxy;\n  }\n  return proxify(object, []);\n}\n"
    ]
}